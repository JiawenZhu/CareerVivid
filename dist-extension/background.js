chrome.runtime.onInstalled.addListener(r=>{r.reason==="install"&&(console.log("CareerVivid Extension installed"),chrome.tabs.create({url:"https://careervivid.app/extension-welcome"})),chrome.contextMenus.create({id:"saveJob",title:"Save Job to CareerVivid",contexts:["page"],documentUrlPatterns:["https://www.linkedin.com/jobs/*","https://www.indeed.com/*"]})});chrome.runtime.onMessage.addListener((r,s,e)=>{switch(r.type){case"GET_RESUME_DATA":return chrome.storage.local.get(["resumes","selectedResumeId"],t=>{e(t)}),!0;case"OPEN_RESUME_PICKER":return chrome.action.openPopup(),e({success:!0}),!0;case"AUTOFILL_APPLICATION":return chrome.tabs.query({active:!0,currentWindow:!0},t=>{t[0]?.id&&chrome.tabs.sendMessage(t[0].id,{type:"FILL_FORM",data:r.data})}),e({success:!0}),!0;case"SAVE_JOB":return chrome.storage.local.get(["trackedJobs"],t=>{const o=t.trackedJobs||[];o.push({...r.job,savedAt:new Date().toISOString(),status:"saved"}),chrome.storage.local.set({trackedJobs:o},()=>{e({success:!0,jobCount:o.length})})}),!0;default:return e({error:"Unknown message type"}),!1}});chrome.contextMenus.onClicked.addListener((r,s)=>{r.menuItemId==="saveJob"&&s?.id&&chrome.tabs.sendMessage(s.id,{type:"EXTRACT_JOB_DATA"},e=>{e?.job&&chrome.storage.local.get(["trackedJobs"],t=>{const o=t.trackedJobs||[];o.push({...e.job,savedAt:new Date().toISOString(),status:"saved"}),chrome.storage.local.set({trackedJobs:o})})})});
