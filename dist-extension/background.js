chrome.runtime.onInstalled.addListener(e=>{e.reason==="install"&&(console.log("CareerVivid Extension installed"),chrome.tabs.create({url:"https://careervivid.app/extension-welcome"})),chrome.contextMenus.create({id:"saveJob",title:"Save Job to CareerVivid",contexts:["page"],documentUrlPatterns:["https://www.linkedin.com/jobs/*","https://www.indeed.com/*"]})});function c(){chrome.cookies.get({url:"https://careervivid.app",name:"session"},e=>{const o=!!e;chrome.storage.local.set({isAuthenticated:o},()=>{chrome.runtime.sendMessage({type:"AUTH_STATE_CHANGED",isAuthenticated:o}).catch(()=>{})})}),chrome.cookies.get({url:"https://careervivid.app",name:"__session"},e=>{e&&chrome.storage.local.set({isAuthenticated:!0})})}chrome.cookies.onChanged.addListener(e=>{e.cookie.domain.includes("careervivid.app")&&c()});c();chrome.runtime.onMessage.addListener((e,o,t)=>{switch(e.type){case"GET_RESUME_DATA":return chrome.storage.local.get(["resumes","selectedResumeId"],r=>{t(r)}),!0;case"OPEN_RESUME_PICKER":return chrome.action.openPopup(),t({success:!0}),!0;case"AUTOFILL_APPLICATION":return chrome.tabs.query({active:!0,currentWindow:!0},r=>{r[0]?.id&&chrome.tabs.sendMessage(r[0].id,{type:"FILL_FORM",data:e.data})}),t({success:!0}),!0;case"SAVE_JOB":return chrome.storage.local.get(["trackedJobs"],r=>{const s=r.trackedJobs||[];s.push({...e.job,savedAt:new Date().toISOString(),status:"saved"}),chrome.storage.local.set({trackedJobs:s},()=>{t({success:!0,jobCount:s.length})})}),!0;default:return t({error:"Unknown message type"}),!1}});chrome.contextMenus.onClicked.addListener((e,o)=>{e.menuItemId==="saveJob"&&o?.id&&chrome.tabs.sendMessage(o.id,{type:"EXTRACT_JOB_DATA"},t=>{t?.job&&chrome.storage.local.get(["trackedJobs"],r=>{const s=r.trackedJobs||[];s.push({...t.job,savedAt:new Date().toISOString(),status:"saved"}),chrome.storage.local.set({trackedJobs:s})})})});
