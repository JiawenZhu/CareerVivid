import{u as A,r as a,j as e,p as U,q,n as g,g as b,w as E,o as F,N as O,O as G,P as Q,Q as H,h as T,x as B}from"./main-D7bwdUQx.js";const V=()=>{const{currentUser:n}=A(),y=a.useRef(null),[j,L]=a.useState([]),[c,N]=a.useState([]),[d,k]=a.useState(""),[x,v]=a.useState(""),[m,w]=a.useState(""),[u,S]=a.useState(""),[D,P]=a.useState(""),[h,_]=a.useState(null),[p,C]=a.useState(null),[I,R]=a.useState(!1),[J,f]=a.useState("idle");a.useEffect(()=>{const t=async()=>{try{const s=q(g(b,"drops"),E("status","==","open")),i=await F(s),l=[];i.forEach(o=>{l.push({id:o.id,...o.data()})}),L(l),l.length>0&&k(l[0].id)}catch(s){console.error("Error fetching drops:",s)}},r=async()=>{if(n)try{const s=q(g(b,"products"),E("merchant_uid","==",n.uid)),i=await F(s),l=[];i.forEach(o=>l.push({id:o.id,...o.data()})),N(l)}catch(s){console.error("Error fetching history:",s)}};t(),r()},[n]);const $=t=>{if(t.target.files&&t.target.files[0]){const r=t.target.files[0];_(r);const s=URL.createObjectURL(r);C(s)}},z=async()=>{if(!n){alert("Please sign in first.");return}if(!d){alert("No active drop selected. Please wait for an open drop.");return}if(!h){alert("Please upload a product image.");return}if(!x||!m||!u){alert("Please fill in all fields.");return}R(!0),f("idle");try{const t=`${Date.now()}_${h.name}`,r=O(G,`products/${n.uid}/${t}`);await Q(r,h);const s=await H(r),i={merchant_uid:n.uid,drop_id:d,name:x,price:parseFloat(m),max_quantity:parseInt(u),description:D,image_url:s,created_at:T()};await B(g(b,"products"),i),f("success"),v(""),w(""),S(""),P(""),_(null),C(null);const l={...i,image_url:s,id:"temp_"+Date.now()};N([l,...c])}catch(t){console.error("Error uploading product:",t),f("error"),alert("Failed to submit product. Check console.")}finally{R(!1)}};return e.jsxs("div",{className:"bg-background-light dark:bg-background-dark text-text-main dark:text-text-light font-display antialiased pb-24 min-h-screen",children:[e.jsx("header",{className:"sticky top-0 z-20 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md border-b border-black/5 dark:border-white/5",children:e.jsxs("div",{className:"flex items-center p-4 justify-between max-w-lg mx-auto",children:[e.jsx("h1",{className:"text-xl font-bold leading-tight tracking-tight flex-1",children:"New Drop Submission"}),e.jsx("button",{className:"flex items-center justify-center h-10 w-10 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"settings"})})]})}),e.jsxs("main",{className:"flex flex-col max-w-lg mx-auto w-full px-4 pt-4 gap-6",children:[e.jsxs("section",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-base font-bold text-text-main dark:text-text-light ml-1",children:"Select Drop"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:d,onChange:t=>k(t.target.value),className:"form-select w-full rounded-xl border-transparent bg-surface-light dark:bg-surface-dark px-4 py-3.5 text-base text-text-main dark:text-text-light focus:border-primary focus:ring-primary/20 focus:ring-4 transition-all appearance-none shadow-sm",children:[j.length===0&&e.jsx("option",{value:"",children:"No Open Drops"}),j.map(t=>e.jsxs("option",{value:t.id,children:[t.zones?.join(", ")," - ",t.scheduled_date]},t.id))]}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none material-symbols-outlined text-gray-400",children:"expand_more"})]})]}),e.jsxs("section",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-base font-bold text-text-main dark:text-text-light ml-1",children:"Product Image"}),e.jsxs("div",{onClick:()=>y.current?.click(),className:`group relative flex flex-col items-center justify-center gap-4 rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700 bg-surface-light dark:bg-surface-dark px-6 py-10 transition-colors hover:border-primary hover:bg-surface-light/50 cursor-pointer ${p?"!border-primary":""}`,children:[p?e.jsxs("div",{className:"relative w-full h-48 rounded-lg overflow-hidden shadow-inner",children:[e.jsx("img",{src:p,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("span",{className:"text-white font-bold flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"edit"})," Change"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-primary/10 dark:bg-primary/20 group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"material-symbols-outlined text-primary text-3xl",children:"add_a_photo"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-bold text-text-main dark:text-text-light",children:"Tap to upload product photo"}),e.jsx("p",{className:"text-xs text-text-secondary dark:text-gray-400 mt-1",children:"Supports: JPG, PNG"})]})]}),e.jsx("input",{ref:y,type:"file",accept:"image/*",className:"hidden",onChange:$})]})]}),e.jsxs("form",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-base font-bold text-text-main dark:text-text-light ml-1",children:"Product Name"}),e.jsx("input",{value:x,onChange:t=>v(t.target.value),className:"form-input w-full rounded-xl border-transparent bg-surface-light dark:bg-surface-dark px-4 py-3.5 text-base text-text-main dark:text-text-light placeholder-gray-400 focus:border-primary focus:ring-primary/20 focus:ring-4 transition-all outline-none shadow-sm",placeholder:"e.g. Fresh Sourdough Loaf",type:"text"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsx("label",{className:"text-base font-bold text-text-main dark:text-text-light ml-1",children:"Price"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold",children:"$"}),e.jsx("input",{value:m,onChange:t=>w(t.target.value),className:"form-input w-full rounded-xl border-transparent bg-surface-light dark:bg-surface-dark pl-8 pr-4 py-3.5 text-base text-text-main dark:text-text-light placeholder-gray-400 focus:border-primary focus:ring-primary/20 focus:ring-4 transition-all outline-none shadow-sm",placeholder:"0.00",type:"number",step:"0.01"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-1/3",children:[e.jsx("label",{className:"text-base font-bold text-text-main dark:text-text-light ml-1",children:"Qty"}),e.jsx("input",{value:u,onChange:t=>S(t.target.value),className:"form-input w-full rounded-xl border-transparent bg-surface-light dark:bg-surface-dark px-4 py-3.5 text-base text-text-main dark:text-text-light placeholder-gray-400 focus:border-primary focus:ring-primary/20 focus:ring-4 transition-all outline-none shadow-sm",placeholder:"10",type:"number"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-base font-bold text-text-main dark:text-text-light ml-1",children:"Description"}),e.jsx("textarea",{value:D,onChange:t=>P(t.target.value),className:"form-textarea w-full rounded-xl border-transparent bg-surface-light dark:bg-surface-dark px-4 py-3.5 text-base text-text-main dark:text-text-light placeholder-gray-400 min-h-[120px] resize-none focus:border-primary focus:ring-primary/20 focus:ring-4 transition-all outline-none shadow-sm",placeholder:"Describe your product (ingredients, origin, etc.)..."})]}),e.jsx("button",{type:"button",onClick:z,disabled:I,className:"mt-2 flex w-full items-center justify-center rounded-xl bg-primary px-6 py-4 text-base font-bold text-[#111b0e] hover:bg-primary/90 active:scale-[0.98] transition-all shadow-lg shadow-primary/20 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none",children:I?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}),"Uploading..."]}):"Add to Next Drop"})]}),e.jsx("div",{className:"my-2 h-px w-full bg-gray-200 dark:bg-white/10"}),e.jsxs("section",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-text-main dark:text-text-light",children:"Your Products"}),e.jsx("button",{className:"text-sm font-bold text-primary hover:underline",children:"View All"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[c.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-4 rounded-xl bg-surface-light dark:bg-surface-dark p-3 border border-transparent hover:border-black/5 dark:hover:border-white/10 shadow-sm transition-all",children:[e.jsx("div",{className:"relative h-16 w-16 flex-shrink-0 overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800",children:e.jsx("img",{src:t.image_url,alt:t.name,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center",children:[e.jsx("h3",{className:"font-bold text-text-main dark:text-text-light leading-tight",children:t.name}),e.jsxs("p",{className:"text-sm text-text-secondary dark:text-gray-400",children:["$",t.price," â€¢ ",t.max_quantity," units"]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",children:e.jsx("span",{className:"inline-flex items-center rounded-full bg-yellow-100 dark:bg-yellow-900/40 px-2.5 py-1 text-xs font-bold text-yellow-800 dark:text-yellow-100 border border-yellow-200 dark:border-yellow-700/50",children:"Submitted"})})]},r)),c.length===0&&e.jsxs("div",{className:"text-center py-8 opacity-50",children:[e.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"inventory_2"}),e.jsx("p",{className:"text-sm font-medium",children:"No products submitted yet."})]})]})]})]}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 border-t border-black/5 dark:border-white/5 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md pb-safe",children:e.jsxs("div",{className:"mx-auto flex max-w-lg items-center justify-around h-16",children:[e.jsxs("button",{onClick:()=>U("/feed"),className:"flex flex-1 flex-col items-center justify-center gap-1 text-gray-400 hover:text-text-main dark:hover:text-text-light transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"home"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Home"})]}),e.jsxs("button",{className:"flex flex-1 flex-col items-center justify-center gap-1 text-primary",children:[e.jsx("span",{className:"material-symbols-outlined text-2xl font-variation-fill",children:"add_circle"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Add Item"})]}),e.jsxs("button",{className:"flex flex-1 flex-col items-center justify-center gap-1 text-gray-400 hover:text-text-main dark:hover:text-text-light transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"inventory_2"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Orders"})]}),e.jsxs("button",{onClick:()=>U("/profile"),className:"flex flex-1 flex-col items-center justify-center gap-1 text-gray-400 hover:text-text-main dark:hover:text-text-light transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"person"}),e.jsx("span",{className:"text-[10px] font-bold",children:"Profile"})]})]})}),e.jsx("style",{children:`
                .font-variation-fill {
                    font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
                }
                .pb-safe {
                    padding-bottom: env(safe-area-inset-bottom, 20px);
                }
            `})]})};export{V as default};
