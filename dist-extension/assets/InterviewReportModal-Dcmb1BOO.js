const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-BDE-LBOn.js","assets/main-D7bwdUQx.js","assets/main-z6OAJ5_I.css"])))=>i.map(i=>d[i]);
import{r as x,j as e,F as W,L as H,_ as R}from"./main-D7bwdUQx.js";import{F as V}from"./FeedbackModal-CbS_Se9-.js";import{B as $}from"./bot-IWhsMCba.js";import{U as I}from"./user-BMBnC3Yd.js";import{X as G}from"./x-DMbiC8dp.js";import{B as X}from"./bar-chart-D4uRodYM.js";import{D as T}from"./download-C1tBlrUM.js";import"./check-circle-Y3w2FutP.js";import"./star-209mo421.js";const _=({text:s=""})=>{const i=s.split(/(\*\*.*?\*\*)/g);return e.jsx("div",{className:"whitespace-pre-wrap",children:i.map((r,d)=>r.startsWith("**")&&r.endsWith("**")?e.jsx("strong",{className:"font-semibold text-primary-600 dark:text-primary-400",children:r.slice(2,-2)},d):e.jsx("span",{children:r},d))})},K=({score:s})=>{const i=typeof s=="number"&&!isNaN(s)?s:0,r=120,d=10,g=(r-d)/2,c=2*Math.PI*g,u=c-i/100*c,b=i>=75?"text-green-500":i>=50?"text-yellow-500":"text-red-500",j=i>=75?"stroke-green-500":i>=50?"stroke-yellow-500":"stroke-red-500";return e.jsxs("div",{className:"relative",style:{width:r,height:r},children:[e.jsxs("svg",{width:r,height:r,viewBox:`0 0 ${r} ${r}`,className:"-rotate-90",children:[e.jsx("circle",{className:"stroke-gray-200 dark:stroke-gray-700",strokeWidth:d,fill:"transparent",r:g,cx:r/2,cy:r/2}),e.jsx("circle",{className:`${j} transition-all duration-1000 ease-out`,strokeWidth:d,fill:"transparent",r:g,cx:r/2,cy:r/2,strokeDasharray:`${c} ${c}`,style:{strokeDashoffset:u},strokeLinecap:"round"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:`text-3xl font-bold ${b}`,children:Math.round(i)}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:"Overall"})]})]})},S=({label:s,score:i})=>{const r=typeof i=="number"&&!isNaN(i)?i:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center text-sm font-medium text-gray-600 dark:text-gray-300 mb-1",children:[e.jsx("span",{children:s}),e.jsxs("span",{className:"font-mono",children:[Math.round(r),"%"]})]}),e.jsx("div",{className:"h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-primary-500 rounded-full transition-all duration-1000 ease-out",style:{width:`${r}%`}})})]})},L=({analysis:s})=>e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 items-center bg-gray-100 dark:bg-gray-900/50 p-6 rounded-lg",children:[e.jsx("div",{className:"md:col-span-1 flex justify-center",children:e.jsx(K,{score:s.overallScore})}),e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsx(S,{label:"Communication",score:s.communicationScore}),e.jsx(S,{label:"Confidence",score:s.confidenceScore}),e.jsx(S,{label:"Answer Relevance",score:s.relevanceScore})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-bold mb-3",children:"Strengths"}),e.jsx("div",{className:"text-sm leading-relaxed",children:e.jsx(_,{text:s.strengths})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-bold mb-3",children:"Areas for Improvement"}),e.jsx("div",{className:"text-sm leading-relaxed",children:e.jsx(_,{text:s.areasForImprovement})})]})]})]}),ae=({jobHistoryEntry:s,onClose:i,isGuestMode:r=!1})=>{const[d,g]=x.useState("feedback"),[c,u]=x.useState(!1),b=x.useRef(null),[j,C]=x.useState(!1),w=x.useMemo(()=>s?.interviewHistory?[...s.interviewHistory].sort((t,n)=>n.timestamp-t.timestamp):[],[s.interviewHistory]),[a,F]=x.useState(w[0]||null);x.useEffect(()=>{if(r)return;const t=parseInt(localStorage.getItem("interviewFeedbackSubmittedCount")||"0",10),n=parseInt(localStorage.getItem("interviewFeedbackClosedCount")||"0",10);if(t<2&&n<2){const o=setTimeout(()=>{C(!0)},2e3);return()=>clearTimeout(o)}},[r]);const P=()=>{const t=parseInt(localStorage.getItem("interviewFeedbackSubmittedCount")||"0",10);localStorage.setItem("interviewFeedbackSubmittedCount",(t+1).toString())},z=()=>{const t=parseInt(localStorage.getItem("interviewFeedbackClosedCount")||"0",10);localStorage.setItem("interviewFeedbackClosedCount",(t+1).toString())};x.useEffect(()=>{const t=n=>{n.key==="Escape"&&i()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[i]);const A=t=>{const n=`Interview Feedback Report
Topic: ${s.job.title}
Date: ${new Date(t.timestamp).toLocaleString()}

`,o=`--- OVERALL SCORE: ${Math.round(t.overallScore||0)}/100 ---
- Communication: ${Math.round(t.communicationScore||0)}%
- Confidence: ${Math.round(t.confidenceScore||0)}%
- Answer Relevance: ${Math.round(t.relevanceScore||0)}%

`,m=`STRENGTHS:
${(t.strengths||"").replace(/\*\*/g,"")}

`,p=`AREAS FOR IMPROVEMENT:
${(t.areasForImprovement||"").replace(/\*\*/g,"")}

`;let l=`--- TRANSCRIPT ---
`;return(t.transcript||[]).forEach(h=>{const f=h.speaker==="ai"?"Interviewer":"You";l+=`${f}:
${h.text}

`}),n+o+m+p+l},E=()=>{if(!a)return;const t=A(a),n=new Blob([t],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(n),m=document.createElement("a");m.href=o,m.download=`interview_report_${a.id}.txt`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(o)},M=async()=>{if(a){u(!0);try{const{jsPDF:t}=await R(async()=>{const{jsPDF:N}=await import("./jspdf.es.min-BDE-LBOn.js");return{jsPDF:N}},__vite__mapDeps([0,1,2])),n=(await R(async()=>{const{default:N}=await import("./html2canvas.esm-DXEQVQnt.js");return{default:N}},[])).default,o=b.current;if(!o)throw new Error("Printable element not found.");const p=(await n(o,{scale:2,useCORS:!0,backgroundColor:"#ffffff"})).toDataURL("image/png"),l=new t("p","mm","a4"),h=l.internal.pageSize.getWidth(),f=l.internal.pageSize.getHeight(),D=l.getImageProperties(p),O=D.width,B=D.height,U=O/h,v=B/U;let y=0,k=v;for(l.addImage(p,"PNG",0,y,h,v),k-=f;k>0;)y-=f,l.addPage(),l.addImage(p,"PNG",0,y,h,v),k-=f;l.save(`interview_report_${a.id}.pdf`)}catch(t){console.error("Failed to generate PDF:",t),alert("Sorry, an error occurred while generating the PDF.")}finally{u(!1)}}};return e.jsxs("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",children:[j&&a&&e.jsx(V,{isOpen:j,onClose:()=>C(!1),onSubmitted:P,onCancel:z,source:"interview",context:{jobId:s.id,jobTitle:s.job.title,analysisId:a.id}}),e.jsx("div",{style:{position:"absolute",top:"-9999px",left:"-9999px",fontFamily:"Inter, sans-serif"},children:a&&e.jsxs("div",{ref:b,className:"bg-white",style:{width:"800px",padding:"40px"},children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Interview Feedback Report"}),e.jsxs("p",{className:"text-sm text-gray-600",children:['For the role of "',s.job.title,'" on ',new Date(a.timestamp).toLocaleDateString()]})]}),e.jsx(L,{analysis:a}),e.jsxs("div",{style:{pageBreakBefore:"always",marginTop:"40px"},children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 pt-4 border-t",children:"Interview Transcript"}),e.jsx("div",{className:"space-y-4",children:a.transcript.map((t,n)=>e.jsxs("div",{className:`flex items-start gap-3 w-full ${t.speaker==="user"?"flex-row-reverse":"items-start"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full text-white flex items-center justify-center ${t.speaker==="ai"?"bg-primary-600":"bg-gray-500"}`,children:t.speaker==="ai"?e.jsx($,{size:18}):e.jsx(I,{size:18})}),e.jsx("div",{className:`p-3 rounded-lg max-w-[80%] text-sm ${t.speaker==="user"?"bg-indigo-500 text-white":"bg-gray-200 text-gray-800"}`,children:e.jsx("p",{className:"whitespace-pre-wrap",children:t.text})})]},n))})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-none md:rounded-lg shadow-2xl w-full h-full md:max-w-5xl md:h-[90vh] flex flex-col md:flex-row",children:[e.jsxs("aside",{className:"hidden md:flex w-1/4 min-w-[200px] bg-gray-50 dark:bg-gray-800/50 border-r dark:border-gray-700 flex-col",children:[e.jsx("h3",{className:"p-4 text-lg font-bold border-b dark:border-gray-700 flex-shrink-0",children:"Session History"}),e.jsx("div",{className:"overflow-y-auto flex-grow",children:w.map(t=>e.jsxs("button",{onClick:()=>F(t),className:`w-full text-left p-4 text-sm border-l-4 ${a?.id===t.id?"bg-primary-50 dark:bg-primary-900/20 border-primary-500":"border-transparent hover:bg-gray-100 dark:hover:bg-gray-700/50"}`,children:[e.jsx("p",{className:"font-semibold",children:new Date(t.timestamp).toLocaleDateString()}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(t.timestamp).toLocaleTimeString()})]},t.id))})]}),e.jsxs("div",{className:"flex-grow flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"p-4 border-b dark:border-gray-700 flex justify-between items-center flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Interview Report"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a?`Analysis from ${new Date(a.timestamp).toLocaleString()}`:"No session selected"})]}),e.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(G,{size:20})})]}),a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-2 flex-shrink-0 bg-gray-50 dark:bg-gray-900/50 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"md:hidden mb-2 px-2",children:[e.jsx("label",{htmlFor:"session-select",className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Session History"}),e.jsx("select",{id:"session-select",value:a?.id||"",onChange:t=>{const n=w.find(o=>o.id===t.target.value);n&&F(n)},className:"block w-full text-base border-gray-300 focus:outline-none focus:ring-primary-500 focus:border-primary-500 rounded-md dark:bg-gray-700 dark:border-gray-600",children:w.map(t=>e.jsx("option",{value:t.id,children:new Date(t.timestamp).toLocaleString()},t.id))})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs("button",{onClick:()=>g("feedback"),className:`px-3 py-1 text-sm font-semibold rounded-md flex items-center gap-2 ${d==="feedback"?"bg-white dark:bg-gray-700 shadow":"text-gray-600 dark:text-gray-300"}`,children:[e.jsx(X,{size:16})," Feedback"]}),e.jsxs("button",{onClick:()=>g("transcript"),className:`px-3 py-1 text-sm font-semibold rounded-md flex items-center gap-2 ${d==="transcript"?"bg-white dark:bg-gray-700 shadow":"text-gray-600 dark:text-gray-300"}`,children:[e.jsx(W,{size:16})," Transcript"]})]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900/50",children:d==="feedback"?e.jsx(L,{analysis:a}):e.jsx("div",{className:"space-y-4",children:a.transcript.map((t,n)=>e.jsxs("div",{className:`flex items-start gap-3 ${t.speaker==="user"?"justify-end":""}`,children:[t.speaker==="ai"&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary-600 text-white flex items-center justify-center",children:e.jsx($,{size:18})}),e.jsx("div",{className:`p-3 rounded-lg max-w-[80%] text-sm ${t.speaker==="user"?"bg-indigo-500 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:e.jsx("p",{className:"whitespace-pre-wrap",children:t.text})}),t.speaker==="user"&&e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gray-500 text-white flex items-center justify-center",children:e.jsx(I,{size:18})})]},n))})}),e.jsx("footer",{className:"p-4 border-t dark:border-gray-700 flex justify-end gap-3 flex-shrink-0",children:r?e.jsx("a",{href:"/signin",className:"bg-primary-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-primary-700",children:"Sign Up to Save & Download Report"}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:E,disabled:c,className:"bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(T,{size:20})," Download TXT"]}),e.jsxs("button",{onClick:M,disabled:c,className:"bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 flex items-center gap-2",children:[c?e.jsx(H,{className:"animate-spin",size:20}):e.jsx(T,{size:20}),c?"Generating...":"Download PDF"]})]})})]}):e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"No report available for this session."})})]})]})]})};export{ae as default};
