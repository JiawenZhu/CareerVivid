import{m as x,q as y,a2 as S,z as f,p,f as g,J as z,K as E,M as L,N as D,v as j,g as N,r as c,j as e,L as R}from"./main-BEc7sVU2.js";import{C as $}from"./check-circle-DqYJ7obf.js";import{X as w}from"./x-CgpMcjbW.js";import{M as b}from"./message-square-Rf8MUyuS.js";import{U as M}from"./user-z_w8hJb6.js";import{S as U}from"./send-BU04lBHk.js";const G="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAADhAC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAA4T8T5LGAAAAAAAAAAAAAAAAAAAA//sQZAAP8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAETEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQZDwAAAGkAAAAAAAAA0gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE",_=()=>{try{const t=new Audio(G);t.volume=.5,t.play().catch(a=>console.warn("Could not play notification sound:",a))}catch(t){console.warn("Audio playback failed:",t)}},v="annotations",J=async(t,a,s,r,A)=>{const n=Date.now(),d=`annotations/${a}/${n}.png`,i=z(E,d);await L(i,s);const u=await D(i),m=x(g,"users",t,"resumes",a,v);return await j(m,{imageUrl:u,objects:A||[],author:r,createdAt:N()}),u},K=(t,a,s)=>{const r=x(g,"users",t,"resumes",a,v),A=y(r,f("createdAt","desc"),S(1));return p(A,n=>{if(n.empty){s(null);return}const d=n.docs[0];s({id:d.id,...d.data()})})},k="comments",O=(t,a,s)=>{const r=x(g,"users",t,"resumes",a,k),A=y(r,f("createdAt","desc"));return p(A,n=>{const d=n.docs.map(i=>({id:i.id,...i.data()}));s(d)})},B=async(t,a,s,r,A)=>{const n=x(g,"users",t,"resumes",a,k);await j(n,{text:s,author:r,userId:A||null,createdAt:N()})},W=({message:t,onClose:a,duration:s=4e3})=>(c.useEffect(()=>{const r=setTimeout(()=>{a()},s);return()=>clearTimeout(r)},[s,a]),e.jsx("div",{className:"fixed bottom-6 right-6 z-[9999] animate-in slide-in-from-bottom-5 duration-300",children:e.jsx("div",{className:"bg-gray-900 dark:bg-gray-800 text-white rounded-lg shadow-2xl border border-gray-700 p-4 pr-12 min-w-[300px] max-w-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx($,{className:"text-green-400",size:20})}),e.jsx("p",{className:"text-sm font-medium",children:t}),e.jsx("button",{onClick:a,className:"absolute top-3 right-3 text-gray-400 hover:text-white transition-colors","aria-label":"Close notification",children:e.jsx(w,{size:16})})]})})})),X=({isOpen:t,onClose:a,resumeId:s,ownerId:r,currentUser:A})=>{const[n,d]=c.useState(""),[i,u]=c.useState([]),[m,V]=c.useState(!1),h=c.useRef(null);c.useEffect(()=>{if(!t)return;const o=O(r,s,l=>{u(l)});return()=>o()},[t,r,s]),c.useEffect(()=>{h.current?.scrollIntoView({behavior:"smooth"})},[i]);const C=async o=>{if(o.preventDefault(),!!n.trim()){V(!0);try{const l=A?`${A.displayName||"User"}`:"Guest Visitor";await B(r,s,n,l,A?.uid),d("")}catch(l){console.error("Failed to add comment:",l),alert("Failed to post comment. Please try again.")}finally{V(!1)}}},T=o=>o===r;return t?e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full md:w-[450px] bg-white dark:bg-gray-900 shadow-2xl z-50 flex flex-col border-l border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 dark:bg-primary-900/30 rounded-lg",children:e.jsx(b,{size:20,className:"text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900 dark:text-white",children:"Comments"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[i.length," ",i.length===1?"comment":"comments"]})]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close comments",children:e.jsx(w,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900/50",children:[i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[e.jsx("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-full mb-4",children:e.jsx(b,{size:32,className:"text-gray-400 dark:text-gray-500"})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium mb-1",children:"No comments yet"}),e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-xs",children:"Be the first to leave feedback!"})]}):i.map(o=>{const l=T(o.userId);return e.jsx("div",{className:`flex flex-col ${l?"items-end":"items-start"}`,children:e.jsxs("div",{className:`flex items-start gap-3 max-w-[85%] ${l?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${l?"bg-indigo-500 text-white":"bg-gray-500 dark:bg-gray-600 text-white"}`,children:e.jsx(M,{size:18})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:`p-3 rounded-lg text-sm ${l?"bg-indigo-500 text-white rounded-tr-none":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded-tl-none"}`,children:[e.jsx("p",{className:"font-semibold text-xs mb-1 opacity-90",children:o.author}),e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:o.text})]}),e.jsx("p",{className:`text-xs text-gray-400 dark:text-gray-500 px-1 ${l?"text-right":"text-left"}`,children:o.createdAt?o.createdAt.toDate().toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):"Just now"})]})]})},o.id)}),e.jsx("div",{ref:h})]}),e.jsx("form",{onSubmit:C,className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:n,onChange:o=>d(o.target.value),placeholder:A?`Comment as ${A.displayName}...`:"Add a comment as Guest...",className:"w-full p-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 focus:outline-none text-sm resize-none transition-all placeholder:text-gray-400 dark:placeholder:text-gray-500 text-gray-900 dark:text-gray-100",rows:3,disabled:m}),e.jsx("button",{type:"submit",disabled:!n.trim()||m,className:"absolute bottom-3 right-3 p-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg disabled:shadow-none","aria-label":"Send comment",children:m?e.jsx(R,{size:16,className:"animate-spin"}):e.jsx(U,{size:16})})]})})]}):null};export{X as C,W as T,K as a,_ as p,O as s,J as u};
