import{e as l,f as u,l as p,T as h,B as r,U as y}from"./main-BEc7sVU2.js";const w=async e=>{const t=l(u,"users",e),s=await p(t);if(!s.exists())throw new Error("User not found");const a=s.data(),n=a.aiUsage;if(!n){const o={count:0,lastResetDate:h.now(),monthlyLimit:10};return await r(t,{aiUsage:o}),o}const m=new Date,g=n.lastResetDate.toDate(),c=(m.getFullYear()-g.getFullYear())*12+(m.getMonth()-g.getMonth());let i=10;const f=a.plan||"free";if(f==="pro_sprint"?i=100:f==="pro_monthly"&&(i=300),c>=1||n.monthlyLimit!==i){const o={count:c>=1?0:n.count,lastResetDate:c>=1?h.now():n.lastResetDate,monthlyLimit:i};return await r(t,{aiUsage:o}),o}return n},d=async e=>{const t=await w(e);if(t.count>=t.monthlyLimit)throw new Error("Monthly AI usage limit reached");const s=l(u,"users",e);await r(s,{"aiUsage.count":y(1)})},D=async e=>{const t=await w(e);return t.count<t.monthlyLimit},L=async(e,t)=>{const s=l(u,"users",e);let a=10;t==="pro_sprint"?a=100:t==="pro_monthly"&&(a=300),await r(s,{"aiUsage.monthlyLimit":a})};export{D as canUseAI,w as getAIUsage,d as incrementAIUsage,L as updateAILimit};
