const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Editor-DCgl5DS6.js","assets/main-Bi0Ei0w3.js","assets/useResumes-B7mK0cuD.js","assets/CommentsPanel-DHI6JJrh.js","assets/check-circle-D957SXgC.js","assets/x-BVB0Dpji.js","assets/message-square-B3pLJ_-8.js","assets/send-B-WXdUxM.js","assets/AlertModal-CxmE_u7v.js","assets/index-DcFGchuU.js","assets/ConfirmationModal-B6wF7Rbq.js","assets/alert-triangle-MW47iQO1.js","assets/FeedbackModal-BwqKd_an.js","assets/star-DKH07wdV.js","assets/sparkles-DKtVAHMK.js","assets/check-B3yF-HgQ.js","assets/ShareResumeModal-B2Hplybl.js","assets/share-2-5k-1k_RB.js","assets/globe-cx_xjewK.js","assets/lock-U6skUTSX.js","assets/copy-Ctg5viPO.js","assets/external-link-neXkVJuu.js","assets/wand-2-DAhyBf_Z.js","assets/trash-2-DdUTv7KT.js","assets/building-2-CIHjYkPv.js","assets/calendar-CutJ-oMs.js","assets/chevron-left-BjtlRDE1.js","assets/ResumePreview-DDWIOQcJ.js","assets/types-C3IBSKjb.js","assets/InlineEdit-DZd6Scr2.js","assets/pen-BDBs_6MJ.js","assets/link-BhQT70ww.js","assets/mail-TURoK-Rd.js","assets/video-DvvOWLCy.js","assets/youtube-DPssPfR1.js","assets/twitter-BrsgoJMC.js","assets/linkedin-DJ3yEV_I.js","assets/map-pin-DPpu8ZWV.js","assets/code-ClBPHmQt.js","assets/graduation-cap-e9Lh-ZpC.js","assets/zap-BQ5sSLdF.js","assets/bar-chart-Cxzz4oii.js","assets/undo-kci31eRs.js","assets/square-C379bsky.js","assets/ThemeToggle-BBy-4iWl.js","assets/sun-g71IOdRO.js","assets/useTranslation-B90S8UVY.js","assets/arrow-left-TCHtPuDE.js","assets/more-vertical-5K-OMTGr.js","assets/eye-Ks_VpovG.js","assets/image-D5NNOkEx.js","assets/download-D6SFpw_f.js","assets/chevron-down-Ca9bpypi.js","assets/geminiService-BYmLfnZm.js","assets/storageService-aG5r1rUc.js","assets/AIImprovementPanel-O6Hg3bnK.js","assets/AIImageEditModal-DWNIAdtd.js","assets/upload-B4M7IYxU.js","assets/MonthYearPicker-CwqWivvT.js","assets/ResumeImport-DoWfhXPQ.js","assets/index-C5AMH0Ns.js","assets/index-Chjiymov.js","assets/pdf.worker.min-BQwZFW_Z.js","assets/alert-circle-C27T-kzG.js","assets/upload-cloud-FT8IZRv8.js","assets/useAICreditCheck-BMgBfCvH.js","assets/chevron-up-CiErZQw3.js","assets/plus-circle-BID7K_rJ.js","assets/palette-CgeLfhC3.js","assets/arrow-right-6YPb1yqF.js","assets/save-CJeSVVE0.js","assets/index-uJmIn182.js","assets/proxy-C8H8TSmu.js","assets/info-DhHZJmFp.js","assets/bar-chart-3-C3Jx8ryh.js","assets/x-circle-CxMxRQAw.js"])))=>i.map(i=>d[i]);
import{r as t,u as Y,j as e,L as z,a as Z,p as k,U as $,R as ee,_ as te}from"./main-Bi0Ei0w3.js";import{P as N}from"./PublicHeader-BgARq-LT.js";import{F as se}from"./Footer-Bop7DoXC.js";import{T as re}from"./ThemeToggle-BBy-4iWl.js";import{s as ae,a as ne,C as oe,T as ie,p as M}from"./CommentsPanel-DHI6JJrh.js";import{A as le}from"./alert-circle-C27T-kzG.js";import{L as _}from"./layout-dashboard-ByEmL4ZA.js";import{L as ce}from"./log-out-N5sficnl.js";import"./LanguageSelect-Cj0_3R1W.js";import"./useTranslation-B90S8UVY.js";import"./globe-cx_xjewK.js";import"./chevron-down-Ca9bpypi.js";import"./check-B3yF-HgQ.js";import"./sun-g71IOdRO.js";import"./x-BVB0Dpji.js";import"./menu-DdXwCEL7.js";import"./zap-BQ5sSLdF.js";import"./link-BhQT70ww.js";import"./check-circle-D957SXgC.js";import"./message-square-B3pLJ_-8.js";import"./send-B-WXdUxM.js";const de=ee.lazy(()=>te(()=>import("./Editor-DCgl5DS6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75]))),Be=()=>{const[l,I]=t.useState(null),[F,u]=t.useState(!0),[S,m]=t.useState(""),[ue,B]=t.useState(.2),[me,fe]=t.useState(!1),[p,D]=t.useState(!1),[V,xe]=t.useState(!1),[R,W]=t.useState(null),[he,H]=t.useState([]),[pe,K]=t.useState(!1),[ge,g]=t.useState(!1),[P,y]=t.useState(null),[E,q]=t.useState([]),b=t.useRef(!0),w=t.useRef(null);t.useRef(null);const f=t.useRef(null),[o,G]=t.useState(null),{currentUser:a,isPremium:ye,isAdmin:be,logOut:J}=Y(),[C,L]=t.useState(!1),j=t.useRef(null);t.useEffect(()=>{const r=s=>{j.current&&!j.current.contains(s.target)&&L(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]);const v=()=>e.jsx("header",{className:"bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800 shadow-sm sticky top-0 z-40 h-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("a",{href:"/dashboard",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-8 w-8"}),e.jsx("span",{className:"text-xl font-bold text-gray-900 dark:text-white hidden sm:inline",children:"CareerVivid"})]})}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsxs("button",{onClick:()=>k("/dashboard"),className:"hidden md:flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors mr-2",children:[e.jsx(_,{size:18}),"Back to Dashboard"]}),e.jsx(re,{}),e.jsxs("div",{className:"relative",ref:j,children:[e.jsx("button",{onClick:()=>L(!C),className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 ring-2 ring-transparent hover:ring-primary-500 transition-all",children:a?.photoURL?e.jsx("img",{src:a.photoURL,alt:"User",className:"w-full h-full rounded-full object-cover"}):e.jsx($,{size:20})}),C&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-xl z-50 border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:a?.displayName||"User"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:a?.email})]}),e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>k("/dashboard"),className:"w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx(_,{size:16})," Dashboard"]}),e.jsxs("button",{onClick:()=>k("/profile"),className:"w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx($,{size:16})," Profile"]}),e.jsxs("button",{onClick:J,className:"w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/10",children:[e.jsx(ce,{size:16})," Sign Out"]})]})]})]})]})]})});t.useEffect(()=>{const r=async(s=0)=>{const c=window.location.pathname.split("?")[0].split("/").filter(x=>x!==""),h=c.indexOf("shared");if(h===-1||c.length<h+3){m("Invalid link format."),u(!1);return}const U=c[h+1],O=c[h+2];G({userId:U,resumeId:O});try{const X=`https://us-west1-jastalk-firebase.cloudfunctions.net/getPublicResume?userId=${encodeURIComponent(U)}&resumeId=${encodeURIComponent(O)}`,d=await fetch(X);if(d.ok){const A=await d.json();I(A),K(A.ownerIsPremium||!1),u(!1)}else d.status===403?(m("This resume is private or no longer shared."),u(!1)):d.status===404?(m("Resume not found."),u(!1)):d.status===500&&s<1?(console.warn("Got 500 error, retrying..."),setTimeout(()=>r(s+1),1500)):(console.error(`Fetch error: ${d.status} ${d.statusText}`),m(`Failed to load resume (Status: ${d.status}). The server might be waking up.`),u(!1))}catch(x){console.error("Error fetching resume:",x),x.message==="Failed to fetch"||x.name==="TypeError"?m("Connection failed. This is likely a CORS issue or the function doesn't have public permissions."):m("Unable to load resume. Please try again later."),u(!1)}};r()},[]),t.useEffect(()=>{if(!l||!o)return;a&&a.uid===o.userId||l.shareConfig?.permission;const r=ae(o.userId,o.resumeId,n=>{if(!b.current&&n.length>E.length){const i=n[0];a&&a.uid===o.userId&&i.userId!==a.uid&&(y(`New feedback received from ${i.author}`),M())}q(n)}),s=ne(o.userId,o.resumeId,n=>{if(n){const i=!!R;W(n.imageUrl),n.objects&&H(n.objects),a&&a.uid===o.userId&&!b.current&&!i&&(y(`New annotation received from ${n.author||"Reviewer"}`),M())}});return setTimeout(()=>{b.current=!1},1e3),()=>{r(),s()}},[l,o,E.length,R,p,V,a]),t.useLayoutEffect(()=>{const r=()=>{if(w.current){const s=w.current.offsetWidth;s>0&&B(Math.min(1,(s-40)/824))}};return l&&(r(),window.addEventListener("resize",r)),()=>window.removeEventListener("resize",r)},[l]),t.useEffect(()=>{const r=s=>{if(s.key==="Escape"||s.code==="Escape"){g(!1),f.current&&(f.current.style.display="none");return}s.metaKey&&s.shiftKey&&(f.current&&(f.current.style.display="flex"),g(!0)),(s.key==="PrintScreen"||s.code==="PrintScreen")&&(f.current&&(f.current.style.display="flex"),g(!0))};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]);const Q=async r=>{if(!o||!l)return;const s={...l,...r};I(s);try{const i=await fetch("https://us-west1-jastalk-firebase.cloudfunctions.net/updatePublicResume",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o.userId,resumeId:o.resumeId,data:r})});if(!i.ok){const c=await i.text();throw console.error("Update failed response:",c),new Error(`Update failed: ${i.status}`)}}catch(n){console.error("Failed to save shared update:",n),alert("Failed to save changes. Please check your connection.")}};if(F)return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex flex-col",children:[a?e.jsx(v,{}):e.jsx(N,{}),e.jsxs("div",{className:"flex-grow flex items-center justify-center flex-col gap-3",children:[e.jsx(z,{className:"w-12 h-12 text-primary-500 animate-spin"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading secure content..."})]})]});if(S||!l||!o)return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex flex-col",children:[a?e.jsx(v,{}):e.jsx(N,{}),e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center p-4 text-center",children:[e.jsx(le,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Unable to View Resume"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md",children:S})]})]});const T=l.shareConfig?.permission||"viewer";if(T==="editor"){const r=window.location.search.substring(1),s=new URLSearchParams(r),n=s.get("viewMode")||"edit",i=s.get("activeTab")||"content";return e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx(z,{className:"animate-spin"})}),children:e.jsx(de,{initialData:l,isShared:!0,onSharedUpdate:Q,initialViewMode:n,initialActiveTab:i})})}return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-950 flex flex-col font-sans relative",children:[a?e.jsx(v,{}):e.jsx(N,{}),e.jsx("div",{className:`bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 pb-4 px-4 shadow-sm sticky z-30 ${a?"top-20 pt-4":"top-0 pt-24"}`}),e.jsx("main",{className:"flex-grow p-4 sm:p-8 relative",ref:w,children:e.jsx("div",{className:`max-w-5xl mx-auto flex justify-center transition-all duration-300 ${p?"mr-[320px]":""}`})}),T==="commenter"&&e.jsx(oe,{isOpen:p,onClose:()=>D(!1),resumeId:o.resumeId,ownerId:o.userId,currentUser:a}),e.jsx(se,{}),P&&e.jsx(ie,{message:P,onClose:()=>y(null)})]})};export{Be as default};
