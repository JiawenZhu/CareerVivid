import{r as n,j as e,L as k,W as C}from"./main-D7bwdUQx.js";import{r as T}from"./index-BLyhGMY8.js";import{e as _}from"./geminiService-y_3auqFB.js";import{d as G,u as W}from"./storageService-BNxWpd1U.js";import{S as q}from"./sparkles-BFipE19n.js";import{X as O}from"./x-DMbiC8dp.js";import{U as B}from"./upload-1Po4FBxs.js";import{C as S}from"./check-CW4K69vK.js";import{D as H}from"./download-C1tBlrUM.js";const P=[{id:"tech_vector",label:"Tech Vector",description:"Google Fi Style",prompt:"A flat vector illustration in the style of corporate tech art. A professional headshot with realistic proportions, distinct black outlines, and flat cel-shaded coloring. Friendly expression, modern casual business attire, solid muted background.",color:"bg-blue-100 text-blue-700",icon:"ðŸŽ¨"},{id:"modern_maker",label:"Modern Maker",description:"Expressive Avatar",prompt:"Digital avatar in a modern corporate illustration style. Character features natural skin tones, expressive facial features, and thick energetic linework. Minimalist shading, vibrant but flat colors, wearing smart-casual office wear.",color:"bg-purple-100 text-purple-700",icon:"ðŸš€"},{id:"campus",label:"Campus Style",description:"Clean Comic",prompt:"A semi-realistic vector portrait. Clean comic-book style inking with bold outlines. The character is looking directly at the viewer with a confident smile. Palette includes primary colors and soft pastels, avoiding gradients in favor of solid color blocks.",color:"bg-green-100 text-green-700",icon:"ðŸŽ“"},{id:"minimalist",label:"Fi Minimalist",description:"High-Fidelity Line",prompt:"High-fidelity vector art headshot. Focus on simple geometry and clear readability at small sizes. Black contour lines, cel-shaded skin tones, and a single solid background color. Resembles high-end tech brand illustrations from 2020.",color:"bg-gray-100 text-gray-700",icon:"âš¡"}],Q=["Make this photo look more professional","Change the background to a blurred office setting","Convert this to a black and white headshot","Change my shirt to a professional collared shirt","Improve the lighting to be brighter and more even","Create a clean, professional avatar from this photo","Replace background with a solid light gray color","Slightly enhance sharpness and color"],re=({userId:w,currentPhoto:u,onSave:v,onUseTemp:K,onClose:h,onError:b,savePath:R})=>{const[A,E]=n.useState(null),[x,f]=n.useState(""),[c,g]=n.useState(!1),[s,y]=n.useState(null),[r,d]=n.useState("current"),[o,j]=n.useState(u),N=n.useRef(null);n.useEffect(()=>{j(u)},[u]);const U=t=>{const a=P.find(l=>l.id===t);a&&(E(t),f(a.prompt))},I=t=>{const a=t.target.files?.[0];if(a){const l=new FileReader;l.onloadend=()=>{j(l.result),y(null),d("current")},l.readAsDataURL(a)}},$=async()=>{if(!x.trim()){b("Prompt Required","Please select a style or enter instructions.");return}g(!0),y(null),d("current");try{let t,a;if(o&&o.startsWith("data:")){const i=o.split(","),m=i[0].match(/:(.*?);/);if(!m)throw new Error("Invalid data URL.");a=m[1],t=i[1]}else if(o&&o.trim().length>0)try{const i=await fetch(o,{mode:"cors"});if(!i.ok)throw new Error(`Failed to load image (Status: ${i.status})`);const m=await i.blob();a=m.type,t=await new Promise((D,M)=>{const p=new FileReader;p.onloadend=()=>D(p.result.split(",")[1]),p.onerror=M,p.readAsDataURL(m)})}catch{throw new Error("Could not access origin image. Please upload directly.")}else throw new Error("No source image found.");const l=await _(w,t,a,x);y(l),d("new")}catch(t){console.error(t),b("Generation Failed",t instanceof Error?t.message:"Unknown error.")}finally{g(!1)}},F=async()=>{const t=r==="new"?s:o;if(t){if(r==="current"&&t.startsWith("http")){v(t),h();return}g(!0);try{const a=G(t);if(!a)throw new Error("Failed to process image.");const l=R||`users/${w}/resume_photos/${Date.now()}_edited.png`,i=await W(a,l);v(i),h()}catch(a){b("Save Failed",a.message)}finally{g(!1)}}},L=()=>{const t=r==="new"?s:o;if(t){const a=document.createElement("a");a.href=t,a.download=`avatar_${Date.now()}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)}},z=e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl shadow-2xl max-h-[95vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-indigo-600"}),"Edit Image with AI"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Transform your photo into a professional avatar."})]}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-500 hover:text-gray-700",children:e.jsx(O,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 custom-scrollbar",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Original"}),r==="current"&&e.jsx("span",{className:"text-xs font-bold text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:"Active"})]}),e.jsxs("div",{onClick:()=>d("current"),className:`
                                    relative aspect-square rounded-2xl overflow-hidden bg-gray-50 border-2 transition-all cursor-pointer group
                                    ${r==="current"?"border-gray-900 shadow-md":"border-transparent hover:border-gray-200"}
                                `,children:[e.jsx("img",{src:o,alt:"Original",className:"w-full h-full object-contain"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsxs("button",{onClick:t=>{t.stopPropagation(),N.current?.click()},className:"bg-white text-black px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 hover:scale-105 transition-transform",children:[e.jsx(B,{size:14})," Upload New"]})}),e.jsx("input",{type:"file",ref:N,className:"hidden",accept:"image/*",onChange:I}),r==="current"&&e.jsx("div",{className:"absolute top-3 right-3 bg-white text-black rounded-full p-1 shadow-sm",children:e.jsx(S,{size:14,strokeWidth:3})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Result"}),r==="new"&&e.jsx("span",{className:"text-xs font-bold text-white bg-indigo-600 px-2 py-0.5 rounded-full",children:"Active"})]}),e.jsxs("div",{onClick:()=>s&&d("new"),className:`
                                    relative aspect-square rounded-2xl overflow-hidden bg-gray-50 border-2 transition-all
                                    ${s?"cursor-pointer":"cursor-default"}
                                    ${r==="new"?"border-indigo-600 shadow-md ring-2 ring-indigo-50":"border-transparent"}
                                    ${s?"":"border-dashed border-gray-200"}
                                `,children:[c?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/80 backdrop-blur-sm z-10",children:[e.jsx(k,{className:"w-10 h-10 text-indigo-600 animate-spin mb-3"}),e.jsx("p",{className:"text-sm font-medium text-indigo-600 animate-pulse",children:"Generating Avatar..."})]}):s?e.jsx("img",{src:s,alt:"Generated",className:"w-full h-full object-contain"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(C,{className:"w-8 h-8 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Preview appears here"})]}),r==="new"&&s&&e.jsx("div",{className:"absolute top-3 right-3 bg-indigo-600 text-white rounded-full p-1 shadow-sm",children:e.jsx(S,{size:14,strokeWidth:3})})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-sm font-bold text-gray-900 mb-3 block",children:"Choose a Style"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:P.map(t=>e.jsxs("button",{onClick:()=>U(t.id),disabled:c,className:`
                                        relative p-3 rounded-xl border-2 text-left transition-all group
                                        ${A===t.id?"border-black bg-gray-50":"border-gray-100 bg-white hover:border-gray-300 hover:shadow-sm"}
                                    `,children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${t.color} flex items-center justify-center text-lg mb-3`,children:t.icon}),e.jsx("h4",{className:"font-bold text-gray-900 text-sm mb-0.5",children:t.label}),e.jsx("p",{className:"text-xs text-gray-500",children:t.description})]},t.id))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-sm font-bold text-gray-900 mb-3 block",children:"Quick Adjustments"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Q.map(t=>e.jsx("button",{onClick:()=>f(a=>a?`${a}, ${t}`:t),disabled:c,className:"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-xs font-medium hover:bg-gray-200 transition-colors border border-transparent hover:border-gray-300 text-left",children:t},t))})]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",value:x,onChange:t=>f(t.target.value),placeholder:"Select a style above or describe your own...",disabled:c,className:"w-full pl-4 pr-32 py-4 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-black/5 focus:border-black transition-all"}),e.jsx("div",{className:"absolute right-2",children:e.jsxs("button",{onClick:$,disabled:c||!x.trim(),className:"bg-black text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-all",children:[c?e.jsx(k,{size:16,className:"animate-spin"}):e.jsx(C,{size:16}),"Generate"]})})]})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-100 bg-gray-50/50 flex items-center justify-between",children:[e.jsx("button",{onClick:h,className:"text-gray-500 hover:text-gray-900 font-medium text-sm px-2",children:"Cancel"}),e.jsxs("div",{className:"flex gap-3",children:[s&&e.jsxs("button",{onClick:L,className:"px-4 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl text-sm font-bold hover:bg-gray-50 transition-colors flex items-center gap-2",children:[e.jsx(H,{size:16})," Save Image"]}),e.jsx("button",{onClick:F,disabled:c,className:"px-6 py-2.5 bg-black text-white rounded-xl text-sm font-bold hover:bg-gray-800 hover:shadow-lg hover:-translate-y-0.5 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save & Apply Profile"})]})]})]})});return T.createPortal(z,document.body)};export{re as default};
