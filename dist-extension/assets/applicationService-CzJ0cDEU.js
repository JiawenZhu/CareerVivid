import{n as u,g as r,q as f,w as m,o as b,f as j,m as h,T as d,B as A,x as g}from"./main-D7bwdUQx.js";const D=async(a,s,o,p)=>{const c=u(r,"jobApplications"),t=d.now(),l=Object.fromEntries(Object.entries({jobPostingId:a,applicantUserId:s,resumeId:o,coverLetter:p,status:"new",statusHistory:[{status:"new",timestamp:t,note:"Application submitted"}],appliedAt:t,lastUpdated:t}).filter(([y,n])=>n!==void 0));return(await g(c,l)).id},M=async a=>{const s=u(r,"jobApplications"),o=f(s,m("jobPostingId","==",a));return(await b(o)).docs.map(t=>({id:t.id,...t.data()})).sort((t,i)=>{const e=t.appliedAt?.toMillis?t.appliedAt.toMillis():0;return(i.appliedAt?.toMillis?i.appliedAt.toMillis():0)-e})},R=async a=>{const s=u(r,"jobApplications"),o=f(s,m("applicantUserId","==",a));return(await b(o)).docs.map(t=>({id:t.id,...t.data()})).sort((t,i)=>{const e=t.appliedAt?.toMillis?t.appliedAt.toMillis():0;return(i.appliedAt?.toMillis?i.appliedAt.toMillis():0)-e})},U=async(a,s,o)=>{const p=j(r,"jobApplications",a),c=await h(p);if(!c.exists())throw new Error("Application not found");const t=c.data(),i={status:s,timestamp:d.now(),note:o};if(await A(p,{status:s,statusHistory:[...t.statusHistory||[],i],lastUpdated:d.now()}),t.applicantUserId&&t.jobPostingId)try{const e=u(r,"users",t.applicantUserId,"jobTracker"),l=f(e,m("jobPostingId","==",t.jobPostingId)),w=await b(l);if(!w.empty){const y=w.docs[0];let n=null;switch(s){case"phone_screen":case"interview":case"final_round":n="Interviewing";break;case"rejected":case"withdrawn":n="Rejected";break;case"offer":case"hired":n="Offered";break}n&&await A(y.ref,{applicationStatus:n,updatedAt:d.now()})}}catch(e){console.error("Failed to sync status to user tracker:",e)}},k=async(a,s)=>{const o=j(r,"jobApplications",a);await A(o,{matchAnalysis:s,lastUpdated:d.now()})};export{R as a,D as b,M as g,k as s,U as u};
