import{r as e,v as I,m as E,f as P,g as N,R as O,j as o,L as A,e as z,l as G}from"./main-BEc7sVU2.js";import{T as y}from"./index-clrG2gCl.js";import{I as W}from"./IntroOverlay-DapoW2Eb.js";import{A as q}from"./alert-circle-gw7bsKwP.js";import"./InlineEdit-LXaiIIc8.js";import"./pen-CDP9jQDD.js";import"./index-Bgwdp8d1.js";import"./x-CgpMcjbW.js";import"./lock-DyNzxupw.js";import"./sun-BCC2DW0J.js";import"./file-text-D4qk8Tzm.js";import"./external-link-B-pRlJeA.js";import"./arrow-right-CSdrhpF5.js";import"./mail-C8AWi2yh.js";import"./globe-DgZdGzus.js";import"./download-BBBdX7JV.js";import"./play-Bdt-AzR7.js";import"./map-pin-OOBizwV5.js";import"./users-CW7lwuWe.js";import"./eye-DBT7NYFb.js";import"./trending-up-BN9QEfSx.js";import"./music-D29n3e9e.js";import"./share-2-DwMXQtQg.js";import"./terminal-CUfv7bRQ.js";import"./chevron-right-C0A4zoBG.js";import"./zap-DGAIHcfp.js";import"./code-DFGvkwP7.js";import"./cardTemplates-CL03FX0S.js";import"./stockPhotos-DkxhX0el.js";import"./smartphone-BeLO5XxV.js";import"./layout-grid-D0eCvmb4.js";import"./youtube-DXIyuMbX.js";import"./twitter-BkzJSFqN.js";import"./linkedin-KoM4kuTt.js";import"./award-BkImyAxc.js";import"./briefcase-BA81y1Cf.js";import"./activity-CQyBVydU.js";import"./calendar-BlywvGr0.js";import"./graduation-cap-CWgYxLce.js";import"./alert-triangle-BabHdlci.js";import"./undo-Zx6Thk0Z.js";import"./arrow-left-jQ4_17tq.js";import"./bar-chart-3-Bibb30BA.js";import"./bar-chart-DqtOAY8p.js";import"./bot-CZVkuU1E.js";import"./building-2-BttomyIW.js";import"./check-circle-2-Y-7OBTyF.js";import"./check-circle-DqYJ7obf.js";import"./check-BXDTBbZe.js";import"./chevron-down-Eiq7K4ut.js";import"./chevron-left-fFcpqHUE.js";import"./chevron-up-DzRpdu-v.js";import"./clock-BtKrYrPy.js";import"./code-2-CCMqSW_o.js";import"./copy-BbzbJe7R.js";import"./credit-card-BsVMY62g.js";import"./confetti.module-eBrm92lW.js";import"./dollar-sign-DcjytobZ.js";import"./eye-off-eUDXhHXq.js";import"./file-code--JYI6on6.js";import"./file-question-Dj6fz501.js";import"./gift-CgF2-90B.js";import"./help-circle-CCgyfrIA.js";import"./home-CXxkeF76.js";import"./image-DpFBMrjV.js";import"./info-D00vMt1z.js";import"./key-round-Cd3I_bbx.js";import"./layout-dashboard-BUznMAJN.js";import"./layout-template-WpqPmEBC.js";import"./link-fr0uO6pY.js";import"./log-out-ByZuvNdb.js";import"./mail-check-DJ0o7HYM.js";import"./volume-x-BMPj_cPW.js";import"./menu-C_yhoOtt.js";import"./message-square-Rf8MUyuS.js";import"./mic-aRUYVZ6D.js";import"./square-B5VCCcX7.js";import"./monitor-DnVXU59Y.js";import"./more-vertical-17dfMr7j.js";import"./store-BElqzBKt.js";import"./palette-BXPG-S57.js";import"./pen-tool-CPcodvGT.js";import"./percent-CJb4_4R_.js";import"./plus-circle-C7ZueYbE.js";import"./plus-BybH-_bu.js";import"./refresh-cw-DfJf90V0.js";import"./rocket-bNzdNsw1.js";import"./save-DuHFw_gZ.js";import"./search-C4vZZ5u7.js";import"./send-BU04lBHk.js";import"./thumbs-up-BedDGc-v.js";import"./shield-alert-CACf201H.js";import"./shield-check-B9I5OclO.js";import"./shield-DouoAU4I.js";import"./productService-DubTcc4o.js";import"./sparkles-Br3FZYhV.js";import"./star-D73ZxPTB.js";import"./stop-circle-D_kwlGPz.js";import"./target-C38gmVKJ.js";import"./trash-2-9UIW2m7q.js";import"./unlink-BN-ijyOT.js";import"./upload-cloud-Bz-Uhqq1.js";import"./upload-ph_HrLW-.js";import"./user-z_w8hJb6.js";import"./video-n-qxSk9V.js";import"./volume-2-Ci9QXAiK.js";import"./wand-2-BNdNGVzL.js";import"./x-circle-DiIKiu2H.js";import"./stripeService-DcCXEwTE.js";import"./index-DZXmDlCI.js";import"./AlertModal-DHZrFFpO.js";import"./index-Chjiymov.js";const H=({portfolioId:n,ownerId:p,enabled:t})=>{const f=e.useRef(!1),u=()=>{let s=localStorage.getItem("cv_visitor_id");return s||(s=crypto.randomUUID(),localStorage.setItem("cv_visitor_id",s)),s};return e.useEffect(()=>{if(!t||!n||!p||f.current)return;(async()=>{try{const m=new URLSearchParams(window.location.search).get("ref")||"direct",h=u();await I(E(P,"users",p,"portfolios",n,"stats"),{type:"view",source:m,timestamp:N(),visitorId:h,userAgent:navigator.userAgent}),f.current=!0,console.log("[Analytics] View logged:",{source:m,visitorId:h})}catch(a){console.error("[Analytics] Failed to log view:",a)}})()},[n,p,t]),{trackClick:async(s,a)=>{if(!(!t||!n||!p))try{const m=u();await I(E(P,"users",p,"portfolios",n,"stats"),{type:"click",targetId:s,label:a,timestamp:N(),visitorId:m}),console.log("[Analytics] Click logged:",{targetId:s,label:a})}catch(m){console.error("[Analytics] Failed to log click:",m)}}}},Yr=()=>{const[n,p]=e.useState(null),[t,f]=e.useState(null),[u,g]=e.useState(!0),[s,a]=e.useState(""),[m,h]=e.useState(!0);e.useEffect(()=>{const r=window.location.pathname.split("/").filter(l=>l!=="");if(r.length>0){const l=r[r.length-1];l!=="portfolio"?p(l):(a("Invalid portfolio link."),g(!1))}else a("Invalid portfolio link."),g(!1)},[]),e.useEffect(()=>{if(!n)return;(async()=>{try{const r=z(P,"public_portfolios",n),l=await G(r);if(l.exists()){const j=l.data();f(j);const M=window.location.pathname;if(j.username&&M.match(/\/portfolio\/[^/]+$/)){const $=`/portfolio/${j.username}/${n}`;window.history.replaceState(null,"",$)}}else a("Portfolio not found or is private.")}catch(r){console.error("Error fetching portfolio:",r),a("Failed to load portfolio.")}finally{g(!1)}})()},[n]);const{trackClick:L}=H({portfolioId:t?.id,ownerId:t?.userId,enabled:!!t}),x=new URLSearchParams(window.location.search),c=x.get("embed")==="true",v=x.get("theme"),b=x.get("orientation"),d=x.get("flipped"),_=d!==null?d==="true":void 0,[F,C]=e.useState(_);e.useEffect(()=>{d!==null&&C(d==="true")},[d]);const k=O.useMemo(()=>{if(!t)return null;let i={...t};return v&&(i.templateId=v),b&&(i.businessCard={...i.businessCard||{},orientation:b}),i},[t,v,b]);if(u)return o.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:o.jsx(A,{className:"w-10 h-10 text-indigo-600 animate-spin"})});if(s||!t)return o.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 text-center p-4",children:[o.jsx(q,{className:"w-16 h-16 text-gray-400 mb-4"}),o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Portfolio Not Found"}),o.jsx("p",{className:"text-gray-600",children:s})]});const T=(()=>{if(k?.mode==="linkinbio"){const i=k.templateId;return["linktree_minimal","linktree_visual","linktree_corporate","linktree_bento"].includes(i)?y[i]:y.linktree_visual}return y[k?.templateId]||y.minimalist})(),D={darkMode:!1},w=t.theme||D,S=w.darkMode,R=w.backgroundColor?.toLowerCase()==="#ffffff"||w.backgroundColor?.toLowerCase()==="#fff",B=S&&R?"#0f1117":w.backgroundColor||(S?"#0f1117":"#ffffff"),U=i=>{t&&f(r=>r?{...r,...i}:null)},V=i=>{const r=i.target.closest("a");if(r&&r.href){if(r.getAttribute("href")?.startsWith("#"))return;const l=r.innerText.trim()||r.getAttribute("aria-label")||"link";L(r.href,l.substring(0,50))}};return o.jsxs("div",{className:`transition-colors duration-500 ${c?"h-full flex items-center justify-center overflow-hidden":"min-h-screen"}`,style:{backgroundColor:c?"transparent":B},onClick:V,children:[!c&&t.linkInBio?.introPage?.enabled&&m&&o.jsx(W,{config:t.linkInBio.introPage,onEnter:()=>h(!1),portfolioId:t.id}),o.jsx(e.Suspense,{fallback:o.jsx("div",{className:"h-screen flex items-center justify-center",children:o.jsx(A,{className:"animate-spin"})}),children:o.jsx("div",{className:c?"w-full h-screen":"",children:o.jsx(T,{data:k,onEdit:void 0,onUpdate:U,isEmbed:c,isFlipped:F,onToggleFlip:C})})}),!c&&!t.linkInBio?.settings?.removeBranding&&o.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:o.jsx("a",{href:"/",className:"bg-black text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg hover:scale-105 transition-transform flex items-center gap-2",children:o.jsx("span",{children:"Build your own with CareerVivid"})})})]})};export{Yr as default};
