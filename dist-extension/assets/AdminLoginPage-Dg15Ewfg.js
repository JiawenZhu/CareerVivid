import{u as L,r as i,j as e,s as G,b as h,c as O,d as T,e as m,f as u,g as x,h as S,i as W,k as Y,l as q,m as b,p as A}from"./main-D7bwdUQx.js";import{S as F}from"./shield-CUs6q-_4.js";import{E as H}from"./eye-off-C3BEQmJh.js";import{E as B}from"./eye-DEr-hoMY.js";const K=({accessDenied:v})=>{const{logOut:n}=L(),[d,P]=i.useState(!0),[l,E]=i.useState("evan@jastalk.com"),[p,D]=i.useState(""),[g,C]=i.useState(!1),[j,t]=i.useState(""),[k,c]=i.useState(""),[y,o]=i.useState(!1);i.useEffect(()=>{v&&(t("Access Denied. You do not have administrator privileges."),n())},[v,n]);const f=a=>{switch(a.code){case"auth/invalid-credential":case"auth/user-not-found":case"auth/wrong-password":t("Invalid email or password.");break;case"auth/email-already-in-use":t('An account with this email already exists. Please "Sign in" instead.');break;default:t(a.message.replace("Firebase: ",""));break}},N=async(a,s)=>{const r=u(x,"admins",a);(await b(r)).exists()?A("/admin"):s==="evan@jastalk.com"?(await m(r,{role:"admin"}),A("/admin")):(t("Access Denied. You do not have administrator privileges."),n())},R=async a=>{a.preventDefault(),o(!0),t(""),c("");try{if(d){const s=await G(h,l,p);await N(s.user.uid,s.user.email)}else{const r=(await O(h,l,p)).user;await T(r),await m(u(x,"users",r.uid),{uid:r.uid,email:r.email,createdAt:S(),status:"active",promotions:{}}),r.email==="evan@jastalk.com"?await m(u(x,"admins",r.uid),{role:"admin"}):(t("This is an admin-only registration. Your account was created but does not have admin privileges."),n())}}catch(s){f(s)}o(!1)},z=async()=>{o(!0),t(""),c("");try{const s=(await Y(h,q)).user;if(s.email!=="evan@jastalk.com"){t("Access Denied. This Google account is not authorized for admin access."),n(),o(!1);return}const r=u(x,"admins",s.uid);(await b(r)).exists()||await m(r,{role:"admin"});const w=u(x,"users",s.uid);(await b(w)).exists()||await m(w,{uid:s.uid,email:s.email,createdAt:S(),status:"active",promotions:{}}),await N(s.uid,s.email)}catch(a){f(a)}o(!1)},I=async()=>{if(!l){t("Please enter your email address to reset your password.");return}o(!0),t(""),c("");try{await W(h,l),c("Password reset email sent! Please check your inbox to continue.")}catch(a){f(a)}o(!1)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-800 px-4",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white dark:bg-gray-900 p-10 rounded-xl shadow-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"w-12 h-12 mx-auto text-primary-500"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900 dark:text-white",children:"Admin Portal"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:R,children:[e.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[e.jsx("div",{children:e.jsx("input",{id:"email-address",name:"email",type:"email",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 text-gray-900 dark:text-white rounded-t-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm bg-white dark:bg-gray-700",placeholder:"Admin email address",value:l,onChange:a=>E(a.target.value)})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",name:"password",type:g?"text":"password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 text-gray-900 dark:text-white rounded-b-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm bg-white dark:bg-gray-700 pr-10",placeholder:"Password",value:p,onChange:a=>D(a.target.value)}),e.jsx("button",{type:"button",onClick:()=>C(!g),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200","aria-label":g?"Hide password":"Show password",children:g?e.jsx(H,{size:20}):e.jsx(B,{size:20})})]})]}),j&&e.jsx("p",{className:"text-sm text-red-500 dark:text-red-400",children:j}),k&&e.jsx("p",{className:"text-sm text-green-500 dark:text-green-400",children:k}),d&&e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("div",{className:"text-sm",children:e.jsx("button",{type:"button",onClick:I,className:"font-medium text-primary-600 hover:text-primary-500 focus:outline-none",children:"Forgot your password?"})})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:y,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:bg-primary-300",children:y?"Processing...":d?"Sign in":"Sign up Admin"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white dark:bg-gray-900 text-gray-500 dark:text-gray-400",children:"Or"})})]}),e.jsx("div",{children:e.jsxs("button",{onClick:z,disabled:y,className:"w-full flex items-center justify-center gap-3 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600",children:[e.jsx("svg",{className:"w-5 h-5","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:e.jsx("path",{fill:"currentColor",d:"M488 261.8C488 403.3 381.5 512 244 512 111.8 512 0 398.2 0 256S111.8 0 244 0c71.2 0 130.9 27.8 176.9 72.9l-63.1 61.3C294.3 93.6 270.3 80 244 80 158.4 80 90 148.2 90 233.9s68.4 153.9 154 153.9c75.5 0 120.9-42.3 124.9-97.9H244v-77.3h236.1c2.4 12.7 3.9 26.1 3.9 40.2z"})}),"Sign in with Google"]})}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-300",children:e.jsx("button",{onClick:()=>{P(!d),t(""),c("")},className:"font-medium text-primary-600 hover:text-primary-500",children:d?"Sign up a new admin account":"Already have an admin account?"})})]})})};export{K as default};
