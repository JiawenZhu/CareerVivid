import{r as a,j as e,L as R,u as B}from"./main-BEc7sVU2.js";import{u as G,c as H,S as N,a as X,d as Y}from"./productService-DubTcc4o.js";import{u as A}from"./storageService-DclJIdxx.js";import{X as Z}from"./x-CgpMcjbW.js";import{F as J}from"./file-text-D4qk8Tzm.js";import{P as K,S as Q}from"./store-BElqzBKt.js";import{I as V}from"./image-DpFBMrjV.js";import{U as W}from"./upload-ph_HrLW-.js";import{A as E}from"./arrow-left-jQ4_17tq.js";import{C as T}from"./credit-card-BsVMY62g.js";import{P as ee}from"./plus-BybH-_bu.js";import{T as re}from"./trending-up-BN9QEfSx.js";import{P as te}from"./pen-CDP9jQDD.js";import{T as ae}from"./trash-2-9UIW2m7q.js";const se=({isOpen:c,onClose:g,userId:i,productToEdit:r,onSuccess:p})=>{const[u,x]=a.useState(""),[j,h]=a.useState(""),[y,d]=a.useState(""),[l,n]=a.useState("digital"),[b,f]=a.useState("usd"),[t,w]=a.useState(null),[S,k]=a.useState(null),[m,P]=a.useState(null),[C,z]=a.useState(!1),[F,v]=a.useState(""),D=a.useRef(null),U=a.useRef(null);a.useEffect(()=>{r?(x(r.title),h(r.description),d((r.price/100).toFixed(2)),n(r.type),f(r.currency),k(r.images[0]||null)):L()},[r,c]);const L=()=>{x(""),h(""),d(""),n("digital"),f("usd"),w(null),k(null),P(null),v("")},O=s=>{if(s.target.files&&s.target.files[0]){const o=s.target.files[0];w(o),k(URL.createObjectURL(o))}},q=s=>{s.target.files&&s.target.files[0]&&P(s.target.files[0])},M=async s=>{s.preventDefault(),z(!0),v("");try{let o=r?.images[0]||"";t&&(o=await A(t,`products / ${i}/${Date.now()}_${t.name}`));let $=r?.fileUrl||"";l==="digital"&&m&&($=await A(m,`digital_downloads/${i}/${Date.now()}_${m.name}`));const _=Math.round(parseFloat(y)*100),I={title:u,description:j,price:_,currency:b,type:l,images:o?[o]:[],fileUrl:l==="digital"?$:void 0,slug:u.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")};r?await G(i,r.id,I):await H(i,I),p(),g()}catch(o){console.error("Submission failed:",o),v("Failed to save product. Please try again.")}finally{z(!1)}};return c?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center sticky top-0 bg-white dark:bg-gray-800 z-10",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:r?"Edit Product":"Add New Product"}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition",children:e.jsx(Z,{size:20,className:"text-gray-500"})})]}),e.jsxs("form",{onSubmit:M,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Product Title"}),e.jsx("input",{type:"text",required:!0,value:u,onChange:s=>x(s.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-blue-500 outline-none transition",placeholder:"e.g. Ultimate Design Guide"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Price"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),e.jsx("input",{type:"number",required:!0,min:"0.50",step:"0.01",value:y,onChange:s=>d(s.target.value),className:"w-full pl-8 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-blue-500 outline-none transition",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition ${l==="digital"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-600":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("input",{type:"radio",className:"hidden",checked:l==="digital",onChange:()=>n("digital")}),e.jsx(J,{size:18})," Digital"]}),e.jsxs("label",{className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border cursor-pointer transition ${l==="physical"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-600":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("input",{type:"radio",className:"hidden",checked:l==="physical",onChange:()=>n("physical")}),e.jsx(K,{size:18})," Physical"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Product Image"}),e.jsxs("div",{onClick:()=>D.current?.click(),className:"aspect-square rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 transition-colors relative overflow-hidden bg-gray-50 dark:bg-gray-800",children:[S?e.jsx("img",{src:S,alt:"Preview",className:"w-full h-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-12 h-12 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Click to upload image"})]}),e.jsx("input",{type:"file",ref:D,className:"hidden",accept:"image/*",onChange:O})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{required:!0,rows:4,value:j,onChange:s=>h(s.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-blue-500 outline-none transition",placeholder:"Describe your product..."})]}),l==="digital"&&e.jsxs("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg border border-indigo-100 dark:border-indigo-800",children:[e.jsxs("h4",{className:"font-medium text-indigo-900 dark:text-indigo-200 mb-2 flex items-center gap-2",children:[e.jsx(W,{size:18})," Digital Asset"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>U.current?.click(),className:"px-4 py-2 bg-white dark:bg-gray-800 border border-indigo-200 dark:border-indigo-700 rounded-lg text-sm text-indigo-700 dark:text-indigo-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:m?"Change File":r?.fileUrl?"Replace File":"Upload File"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 truncate max-w-[200px]",children:m?m.name:r?.fileUrl?"File already uploaded":"No file selected"})]}),e.jsx("input",{type:"file",ref:U,className:"hidden",onChange:q}),e.jsx("p",{className:"text-xs text-indigo-600/70 dark:text-indigo-400/70 mt-2",children:"Supported formats: PDF, ZIP, PNG, etc. Securely stored."})]}),F&&e.jsx("div",{className:"p-3 bg-red-100 text-red-700 rounded-lg text-sm",children:F}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:g,className:"px-6 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:C,className:"px-6 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-wait",children:[C&&e.jsx(R,{size:18,className:"animate-spin"}),r?"Save Changes":"Create Product"]})]})]})]})}):null},pe=({isEmbedded:c=!1,onProductsChange:g})=>{const{currentUser:i}=B(),[r,p]=a.useState([]),[u,x]=a.useState(!0),[j,h]=a.useState(null),[y,d]=a.useState(!1),[l,n]=a.useState(null),b=async()=>{if(i){x(!0);try{const t=await X(i.uid);p(t),g&&g(t)}catch(t){console.error("Error fetching commerce data:",t)}finally{x(!1)}}};a.useEffect(()=>{b()},[i]);const f=async t=>{!i||!window.confirm("Are you sure you want to delete this product?")||(await Y(i.uid,t),b())};return u?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(R,{className:"animate-spin text-blue-600",size:32})}):e.jsxs("div",{className:` min-h-screen bg-gray-50 dark:bg-gray-900 ${c?"flex-1 overflow-y-auto p-6 md:p-8 bg-gray-50 dark:bg-black/20":"p-8"}`,children:[e.jsxs("div",{className:`max-w-6xl mx-auto space-y-8 ${c?"max-w-4xl":""}`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[!c&&e.jsxs("button",{onClick:async()=>{if(i&&r.length>=0)try{document.referrer.includes("/edit/")?window.history.back():window.location.href="/dashboard"}catch{window.history.back()}else window.history.back()},className:"flex items-center gap-2 text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white mb-2 transition-colors",children:[e.jsx(E,{size:16})," Back to Editor"]}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(Q,{className:"text-blue-600"}),"Commerce Hub"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage your products and earnings."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{disabled:!0,className:"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-gray-400 dark:text-gray-500 font-medium cursor-not-allowed flex items-center gap-2 relative opacity-70",children:[e.jsx(T,{size:18}),"Connect Stripe",e.jsx("span",{className:"absolute -top-2 -right-2 bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-300 text-[10px] font-bold px-1.5 py-0.5 rounded-full border border-gray-200 dark:border-gray-600",children:"SOON"})]}),e.jsxs("button",{onClick:()=>{n(null),d(!0)},className:"px-4 py-2 bg-blue-600 rounded-lg text-white font-medium hover:bg-blue-700 transition flex items-center gap-2 shadow-lg hover:shadow-blue-500/25",children:[e.jsx(ee,{size:20}),"Add Product"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 opacity-80 mb-2",children:[e.jsx(re,{size:20}),e.jsx("span",{className:"font-medium",children:"Total Revenue"})]}),e.jsx("div",{className:"text-3xl font-bold",children:"$0.00"}),e.jsx("div",{className:"text-sm opacity-60 mt-2",children:"Lifetime earnings"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(N,{size:20}),e.jsx("span",{className:"font-medium",children:"Active Products"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:r.length})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center",children:e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Your Products"})}),r.length===0?e.jsxs("div",{className:"p-12 text-center text-gray-500 dark:text-gray-400",children:[e.jsx(N,{size:48,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No products yet"}),e.jsx("p",{className:"text-sm mb-6",children:"Start selling digital courses, templates, or physical goods."}),e.jsx("button",{onClick:()=>{n(null),d(!0)},className:"text-blue-600 hover:underline font-medium",children:"Create your first product"})]}):e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:r.map(t=>e.jsxs("div",{className:"p-6 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-750 transition",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 dark:bg-gray-900 overflow-hidden flex-shrink-0",children:t.images[0]?e.jsx("img",{src:t.images[0],alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(N,{size:24})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white text-lg",children:t.title}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400 mt-1",children:[e.jsxs("span",{className:"font-mono bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-700 dark:text-gray-300",children:["$",(t.price/100).toFixed(2)]}),e.jsx("span",{className:"capitalize px-2 py-0.5 rounded border border-gray-200 dark:border-gray-600 text-xs",children:t.type})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{n(t),d(!0)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit",children:e.jsx(te,{size:18})}),e.jsx("button",{onClick:()=>f(t.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete",children:e.jsx(ae,{size:18})})]})]},t.id))})]})]}),e.jsx(se,{isOpen:y,onClose:()=>d(!1),userId:i?.uid||"",productToEdit:l,onSuccess:()=>{b()}})]})};export{pe as default};
