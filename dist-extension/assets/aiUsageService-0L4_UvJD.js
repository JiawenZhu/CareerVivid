import{f as l,g as m,m as p,T as h,D as r,a1 as y}from"./main-Bi0Ei0w3.js";const w=async e=>{const t=l(m,"users",e),s=await p(t);if(!s.exists())throw new Error("User not found");const a=s.data(),n=a.aiUsage;if(!n){const o={count:0,lastResetDate:h.now(),monthlyLimit:10};return await r(t,{aiUsage:o}),o}const u=new Date,g=n.lastResetDate.toDate(),c=(u.getFullYear()-g.getFullYear())*12+(u.getMonth()-g.getMonth());let i=10;const f=a.plan||"free";if(f==="pro_sprint"?i=100:f==="pro_monthly"&&(i=300),c>=1||n.monthlyLimit!==i){const o={count:c>=1?0:n.count,lastResetDate:c>=1?h.now():n.lastResetDate,monthlyLimit:i};return await r(t,{aiUsage:o}),o}return n},D=async e=>{const t=await w(e);if(t.count>=t.monthlyLimit)throw new Error("Monthly AI usage limit reached");const s=l(m,"users",e);await r(s,{"aiUsage.count":y(1)})},d=async e=>{const t=await w(e);return t.count<t.monthlyLimit},L=async(e,t)=>{const s=l(m,"users",e);let a=10;t==="pro_sprint"?a=100:t==="pro_monthly"&&(a=300),await r(s,{"aiUsage.monthlyLimit":a})};export{d as canUseAI,w as getAIUsage,D as incrementAIUsage,L as updateAILimit};
