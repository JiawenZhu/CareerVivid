import{e as ee,f as k,B as te,U as se,v as re,m as R,g as ae,q as oe,a2 as ie,z as le,p as ne,r,j as e}from"./main-BEc7sVU2.js";import{T as E,C as I,M as f,c as M}from"./confetti.module-eBrm92lW.js";import{u as ce}from"./index-CScl1Xt6.js";import{U as de}from"./upload-cloud-Bz-Uhqq1.js";import{m as n}from"./proxy-CygPNp2F.js";import{U as xe}from"./user-z_w8hJb6.js";import{P as me}from"./play-Bdt-AzR7.js";import{A as b}from"./index-DDV-88Q9.js";import{X as he}from"./x-CgpMcjbW.js";import{S as ue}from"./search-C4vZZ5u7.js";import{C as pe}from"./chevron-up-DzRpdu-v.js";import"./index-Chjiymov.js";const C="tiktok_leaderboard",w={subscribeToLeaderboard:(i,a=50)=>{const o=oe(R(k,C),le("score","desc"),ie(a));return ne(o,h=>{const c=h.docs.map(u=>({id:u.id,...u.data()}));i(c)})},addPlayer:async i=>{try{return(await re(R(k,C),{name:i,score:0,createdAt:ae()})).id}catch(a){throw console.error("Error adding player:",a),a}},updateScore:async(i,a=1)=>{if(i)try{const o=ee(k,C,i);await te(o,{score:se(a)})}catch(o){console.error("Error updating score:",o)}}},Le=()=>{const[i,a]=r.useState("UPLOAD"),[o,h]=r.useState(null),[c,u]=r.useState(""),[P,F]=r.useState(25),[S,A]=r.useState(!1),[fe,g]=r.useState(0),[D,U]=r.useState([]),[x,O]=r.useState([]),[l,z]=r.useState(null),[G,j]=r.useState(!1),[B,y]=r.useState(!1),[p,Y]=r.useState(""),N=r.useRef(0),T=r.useRef(0),v=r.useRef(0),$=r.useCallback(t=>{const s=t[0];if(s){const d=URL.createObjectURL(s);h(d),a("ONBOARDING")}},[]),{getRootProps:H,getInputProps:q,isDragActive:X}=ce({onDrop:$,accept:{"image/*":[]},maxFiles:1}),_=async()=>{if(c.trim())try{const t=await w.addPlayer(c);z(t),a("PLAYING"),j(!0)}catch(t){console.error("Failed to start game:",t)}};r.useEffect(()=>{const t=w.subscribeToLeaderboard(s=>{O(s.map(d=>({...d,isCurrentUser:d.id===l})))});return()=>t()},[l]),r.useEffect(()=>{if(l){const t=x.find(s=>s.id===l);t&&g(t.score)}},[x,l]);const Q=t=>{t.stopPropagation(),S||(F(s=>s+1),A(!0),g(s=>s+10),l&&w.updateScore(l,10),V(t.clientX,t.clientY))},W=t=>{const{clientX:s,clientY:d}=t,L={id:Date.now(),x:s,y:d,rotation:Math.random()*30-15};U(m=>[...m,L]),setTimeout(()=>U(m=>m.filter(Z=>Z.id!==L.id)),1e3),g(m=>m+1),l&&w.updateScore(l,1),J()},V=(t,s)=>{M({particleCount:30,spread:50,origin:{x:t/window.innerWidth,y:s/window.innerHeight},colors:["#FE2C55","#25F4EE","#ffffff"],disableForReducedMotion:!0})},J=()=>{const t=Date.now();if(t-T.current<500?N.current+=1:N.current=1,T.current=t,N.current%5===0){v.current=Math.min(v.current+1,10);const s=30*v.current;M({particleCount:s,spread:120,origin:{y:.6},colors:["#FE2C55","#25F4EE","#ffffff"],zIndex:9999})}},K=()=>{h("/assets/templates/tiktok/IMG_2395.png"),a("ONBOARDING")};return i==="UPLOAD"?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-gray-800 rounded-2xl p-8 shadow-2xl border border-gray-700 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Magic Mirror"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"Gamify your TikTok profile in seconds."}),e.jsxs("div",{...H(),className:`
                            border-2 border-dashed rounded-xl p-10 cursor-pointer transition-all
                            ${X?"border-indigo-500 bg-indigo-500/10":"border-gray-600 hover:border-gray-500 hover:bg-gray-700/50"}
                        `,children:[e.jsx("input",{...q()}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-gray-700 rounded-full",children:e.jsx(de,{className:"w-8 h-8 text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-lg",children:"Upload Screenshot"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Take a screenshot of your TikTok profile"})]})]})]}),e.jsx("button",{onClick:K,className:"text-sm text-gray-400 hover:text-white underline underline-offset-4 transition-colors mt-6",children:"Skip upload (Use Sample Profile)"})]})}):i==="ONBOARDING"?e.jsxs("div",{className:"min-h-screen bg-black/90 flex items-center justify-center p-4 relative",children:[o&&e.jsx("img",{src:o,className:"absolute inset-0 w-full h-full object-cover opacity-20 blur-sm"}),e.jsxs(n.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"relative z-10 max-w-sm w-full bg-white/10 backdrop-blur-xl border border-white/20 rounded-3xl p-8 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-tr from-pink-500 to-indigo-500 rounded-full mx-auto mb-4 flex items-center justify-center shadow-lg",children:e.jsx(xe,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Who is playing?"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Enter your name to join the leaderboard."})]}),e.jsx("input",{type:"text",placeholder:"Your Name",value:c,onChange:t=>u(t.target.value),className:"w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-pink-500 mb-6 text-center text-lg font-medium",autoFocus:!0}),e.jsxs("button",{onClick:_,disabled:!c.trim(),className:"w-full py-4 bg-white text-black font-bold rounded-xl shadow-lg hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(me,{className:"w-5 h-5 fill-current"})," Start Game"]})]})]}):e.jsxs("div",{className:"relative w-full min-h-screen bg-black overflow-hidden flex justify-center selection:bg-transparent",onClick:W,children:[e.jsx(b,{children:G&&e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/80 flex flex-col items-center justify-center p-8 text-center",onClick:t=>{t.stopPropagation(),j(!1)},children:[e.jsxs("div",{className:"max-w-xs space-y-8 pointer-events-none",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto ring-4 ring-pink-500/50 animate-pulse",children:e.jsx("span",{className:"text-3xl",children:"üëÜ"})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Tap to Like"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap anywhere on the screen to send hearts and climb the leaderboard."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto ring-4 ring-cyan-500/50",children:e.jsx("span",{className:"text-3xl",children:"üî•"})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Build Combos"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap fast to trigger fireworks and multiply your score."})]})]}),e.jsx("button",{className:"mt-12 px-8 py-3 bg-white text-black font-bold rounded-full hover:scale-105 active:scale-95 transition-transform pointer-events-auto",onClick:t=>{t.stopPropagation(),j(!1)},children:"Got it!"})]})}),e.jsx(b,{children:B&&e.jsxs(n.div,{initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-50 bg-black/95 backdrop-blur-xl flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 flex items-center justify-between bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"w-6 h-6 text-yellow-500"}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Leaderboard"})]}),e.jsx("button",{onClick:()=>y(!1),className:"p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors",children:e.jsx(he,{className:"w-6 h-6 text-white"})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search players...",value:p,onChange:t=>Y(t.target.value),className:"w-full bg-white/10 border border-white/10 rounded-xl pl-12 pr-4 py-4 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:e.jsxs("div",{className:"space-y-3 max-w-2xl mx-auto",children:[x.filter(t=>t.name.toLowerCase().includes(p.toLowerCase())).map((t,s)=>e.jsxs(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.05},className:`
                                            flex items-center justify-between p-4 rounded-2xl border
                                            ${t.isCurrentUser?"bg-gradient-to-r from-pink-500/20 to-indigo-500/20 border-pink-500/50":"bg-white/5 border-white/5 hover:bg-white/10"}
                                            transition-colors
                                        `,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 text-center font-bold text-xl text-white/50",children:s===0?e.jsx(I,{className:"w-8 h-8 text-yellow-400 mx-auto"}):s===1?e.jsx(f,{className:"w-7 h-7 text-gray-300 mx-auto"}):s===2?e.jsx(f,{className:"w-7 h-7 text-amber-700 mx-auto"}):e.jsxs("span",{className:"text-lg",children:["#",s+1]})}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-lg ${t.isCurrentUser?"font-bold text-white":"font-medium text-gray-200"}`,children:[t.name," ",t.isCurrentUser&&"(You)"]}),t.isCurrentUser&&e.jsx("p",{className:"text-xs text-pink-400 font-medium",children:"That's you!"})]})]}),e.jsxs("div",{className:"text-xl font-mono font-bold text-pink-400 bg-pink-500/10 px-4 py-2 rounded-lg border border-pink-500/20",children:[t.score," ‚ù§Ô∏è"]})]},t.id)),x.filter(t=>t.name.toLowerCase().includes(p.toLowerCase())).length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:['No players found matching "',p,'"']})]})})]})}),e.jsxs("div",{className:"relative w-full max-w-md h-auto",children:[o?e.jsx("img",{src:o,alt:"TikTok Profile",className:"w-full h-auto object-contain pointer-events-none"}):e.jsx("div",{className:"w-full h-screen bg-gray-900 flex items-center justify-center",children:e.jsx("p",{className:"text-white",children:"No Image Loaded"})}),e.jsx("div",{className:"absolute z-10 bg-white flex items-center justify-center font-bold text-gray-900 leading-none pointer-events-none",style:{top:"28.1%",left:"42%",width:"35px",height:"20px",fontSize:"17px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'},children:P}),e.jsx(n.div,{whileTap:{scale:.95},onClick:Q,className:"absolute z-20 cursor-pointer",style:{top:"41%",left:"5%",width:"43%",height:"5.5%",borderRadius:"4px",backgroundColor:"transparent"},children:S&&e.jsx("div",{className:"w-full h-full bg-gray-100 border border-gray-300 rounded-[2px] flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:"Message"})})})]}),e.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-sm z-40",children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[40vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10 bg-white/5 cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>y(!0),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-yellow-400"}),e.jsx("span",{className:"text-sm font-bold text-white uppercase tracking-wider",children:"Live Top 10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-2 py-0.5 bg-pink-500/20 text-pink-400 text-[10px] font-bold rounded-full border border-pink-500/30 animate-pulse",children:"LIVE"}),e.jsx(pe,{className:"w-4 h-4 text-white/50"})]})]}),e.jsxs("div",{className:"overflow-y-auto custom-scrollbar p-2",children:[e.jsx(b,{children:x.slice(0,10).map((t,s)=>e.jsxs(n.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`
                                        flex items-center justify-between p-2 rounded-lg mb-1
                                        ${t.isCurrentUser?"bg-indigo-500/30 border border-indigo-500/50":"hover:bg-white/5"}
                                    `,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 text-center font-bold text-xs text-white/50",children:s===0?e.jsx(I,{className:"w-3.5 h-3.5 text-yellow-400 mx-auto"}):s===1?e.jsx(f,{className:"w-3.5 h-3.5 text-gray-300 mx-auto"}):s===2?e.jsx(f,{className:"w-3.5 h-3.5 text-amber-700 mx-auto"}):e.jsxs("span",{children:["#",s+1]})}),e.jsxs("span",{className:`text-sm truncate max-w-[120px] ${t.isCurrentUser?"font-bold text-white":"font-medium text-white/90"}`,children:[t.name," ",t.isCurrentUser&&"(You)"]})]}),e.jsx("div",{className:"text-xs font-mono font-bold text-pink-400",children:t.score})]},t.id))}),e.jsx("div",{onClick:()=>y(!0),className:"text-center py-2 text-xs text-white/40 hover:text-white cursor-pointer transition-colors border-t border-white/5 mt-1",children:"Tap to see full rankings"})]})]})}),e.jsx(b,{children:D.map(t=>e.jsx(n.div,{initial:{opacity:1,scale:0,y:0,x:0},animate:{opacity:0,scale:1,y:-200,x:(Math.random()-.5)*50},exit:{opacity:0},transition:{duration:1,ease:"easeOut"},className:"fixed pointer-events-none z-50 text-4xl drop-shadow-lg",style:{left:t.x,top:t.y,rotate:t.rotation},children:"‚ù§Ô∏è"},t.id))})]})};export{Le as default};
