import{r as i,x as I,n as E,g as P,h as N,R as O,j as o,L as A,f as z,m as G}from"./main-Bi0Ei0w3.js";import{T as y}from"./index-JvRjm1I4.js";import{I as W}from"./IntroOverlay-njhw10VY.js";import{A as q}from"./alert-circle-C27T-kzG.js";import"./InlineEdit-DZd6Scr2.js";import"./pen-BDBs_6MJ.js";import"./index-DcFGchuU.js";import"./x-BVB0Dpji.js";import"./lock-U6skUTSX.js";import"./sun-g71IOdRO.js";import"./external-link-neXkVJuu.js";import"./arrow-right-6YPb1yqF.js";import"./mail-TURoK-Rd.js";import"./globe-cx_xjewK.js";import"./download-D6SFpw_f.js";import"./play-DVOSIuGe.js";import"./map-pin-DPpu8ZWV.js";import"./users-DagC7-ml.js";import"./eye-Ks_VpovG.js";import"./trending-up-D0rHZCji.js";import"./music-CD4LfeBt.js";import"./share-2-5k-1k_RB.js";import"./terminal-gy7eb2-N.js";import"./zap-BQ5sSLdF.js";import"./code-ClBPHmQt.js";import"./cardTemplates-B0OrrjBc.js";import"./stockPhotos-DkxhX0el.js";import"./smartphone-Bs9I7iS9.js";import"./layout-grid-PVPD0WxJ.js";import"./youtube-DPssPfR1.js";import"./twitter-BrsgoJMC.js";import"./linkedin-DJ3yEV_I.js";import"./award-BNfQ991F.js";import"./activity-K-54Ez0K.js";import"./calendar-CutJ-oMs.js";import"./graduation-cap-e9Lh-ZpC.js";import"./alert-triangle-MW47iQO1.js";import"./undo-kci31eRs.js";import"./arrow-left-TCHtPuDE.js";import"./bar-chart-3-C3Jx8ryh.js";import"./bar-chart-Cxzz4oii.js";import"./bot-DSb0l_Gf.js";import"./building-2-CIHjYkPv.js";import"./check-circle-2-34LvQiKB.js";import"./check-circle-D957SXgC.js";import"./check-B3yF-HgQ.js";import"./chevron-down-Ca9bpypi.js";import"./chevron-left-BjtlRDE1.js";import"./chevron-up-CiErZQw3.js";import"./clock-D1CHQ9zP.js";import"./code-2-Dkc7GTNQ.js";import"./copy-Ctg5viPO.js";import"./credit-card-NEFea8JW.js";import"./confetti.module-DVGOVhuI.js";import"./dollar-sign-DzNdP9uA.js";import"./eye-off-BT8a98df.js";import"./file-code-uG6uZ0_e.js";import"./file-question-CnSMxmzP.js";import"./gift-DBAgIoc1.js";import"./help-circle-BUBwBwEx.js";import"./image-D5NNOkEx.js";import"./info-DhHZJmFp.js";import"./key-round-Bi0Etawh.js";import"./layout-dashboard-ByEmL4ZA.js";import"./layout-template-Cb8aid89.js";import"./link-BhQT70ww.js";import"./log-out-N5sficnl.js";import"./mail-check-Ca-XmVtE.js";import"./volume-x-DOVC_tw9.js";import"./menu-DdXwCEL7.js";import"./message-square-B3pLJ_-8.js";import"./square-C379bsky.js";import"./monitor-BNQ-AdM8.js";import"./more-vertical-5K-OMTGr.js";import"./store-KdD1zq5_.js";import"./palette-CgeLfhC3.js";import"./pen-tool-CJ0S_gCC.js";import"./percent-B43c6ypi.js";import"./plus-circle-BID7K_rJ.js";import"./refresh-cw-DY32XjOM.js";import"./rocket-Dq-QQe-O.js";import"./save-CJeSVVE0.js";import"./search-81kCQAS9.js";import"./send-B-WXdUxM.js";import"./thumbs-up-DIZO9jd_.js";import"./shield-alert-CR3cD6gc.js";import"./shield-check-XdvqUlmA.js";import"./shield-D8jVxe4m.js";import"./productService-BhTKM8RX.js";import"./sparkles-DKtVAHMK.js";import"./star-DKH07wdV.js";import"./stop-circle-D01e3zZi.js";import"./target-DF6wfNVB.js";import"./trash-2-DdUTv7KT.js";import"./unlink-F8-J2xYy.js";import"./upload-cloud-FT8IZRv8.js";import"./upload-B4M7IYxU.js";import"./video-DvvOWLCy.js";import"./volume-2-CWjJsluY.js";import"./wand-2-DAhyBf_Z.js";import"./x-circle-CxMxRQAw.js";import"./stripeService-ByGudE7C.js";import"./index-DZXmDlCI.js";import"./AlertModal-CxmE_u7v.js";import"./index-Chjiymov.js";const H=({portfolioId:n,ownerId:c,enabled:t})=>{const f=i.useRef(!1),u=()=>{let s=localStorage.getItem("cv_visitor_id");return s||(s=crypto.randomUUID(),localStorage.setItem("cv_visitor_id",s)),s};return i.useEffect(()=>{if(!t||!n||!c||f.current)return;(async()=>{try{const m=new URLSearchParams(window.location.search).get("ref")||"direct",h=u();await I(E(P,"users",c,"portfolios",n,"stats"),{type:"view",source:m,timestamp:N(),visitorId:h,userAgent:navigator.userAgent}),f.current=!0,console.log("[Analytics] View logged:",{source:m,visitorId:h})}catch(a){console.error("[Analytics] Failed to log view:",a)}})()},[n,c,t]),{trackClick:async(s,a)=>{if(!(!t||!n||!c))try{const m=u();await I(E(P,"users",c,"portfolios",n,"stats"),{type:"click",targetId:s,label:a,timestamp:N(),visitorId:m}),console.log("[Analytics] Click logged:",{targetId:s,label:a})}catch(m){console.error("[Analytics] Failed to log click:",m)}}}},Wr=()=>{const[n,c]=i.useState(null),[t,f]=i.useState(null),[u,g]=i.useState(!0),[s,a]=i.useState(""),[m,h]=i.useState(!0);i.useEffect(()=>{const r=window.location.pathname.split("/").filter(l=>l!=="");if(r.length>0){const l=r[r.length-1];l!=="portfolio"?c(l):(a("Invalid portfolio link."),g(!1))}else a("Invalid portfolio link."),g(!1)},[]),i.useEffect(()=>{if(!n)return;(async()=>{try{const r=z(P,"public_portfolios",n),l=await G(r);if(l.exists()){const j=l.data();f(j);const M=window.location.pathname;if(j.username&&M.match(/\/portfolio\/[^/]+$/)){const $=`/portfolio/${j.username}/${n}`;window.history.replaceState(null,"",$)}}else a("Portfolio not found or is private.")}catch(r){console.error("Error fetching portfolio:",r),a("Failed to load portfolio.")}finally{g(!1)}})()},[n]);const{trackClick:L}=H({portfolioId:t?.id,ownerId:t?.userId,enabled:!!t}),x=new URLSearchParams(window.location.search),p=x.get("embed")==="true",v=x.get("theme"),b=x.get("orientation"),d=x.get("flipped"),_=d!==null?d==="true":void 0,[F,C]=i.useState(_);i.useEffect(()=>{d!==null&&C(d==="true")},[d]);const k=O.useMemo(()=>{if(!t)return null;let e={...t};return v&&(e.templateId=v),b&&(e.businessCard={...e.businessCard||{},orientation:b}),e},[t,v,b]);if(u)return o.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:o.jsx(A,{className:"w-10 h-10 text-indigo-600 animate-spin"})});if(s||!t)return o.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 text-center p-4",children:[o.jsx(q,{className:"w-16 h-16 text-gray-400 mb-4"}),o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Portfolio Not Found"}),o.jsx("p",{className:"text-gray-600",children:s})]});const T=(()=>{if(k?.mode==="linkinbio"){const e=k.templateId;return["linktree_minimal","linktree_visual","linktree_corporate","linktree_bento"].includes(e)?y[e]:y.linktree_visual}return y[k?.templateId]||y.minimalist})(),D={darkMode:!1},w=t.theme||D,S=w.darkMode,R=w.backgroundColor?.toLowerCase()==="#ffffff"||w.backgroundColor?.toLowerCase()==="#fff",B=S&&R?"#0f1117":w.backgroundColor||(S?"#0f1117":"#ffffff"),U=e=>{t&&f(r=>r?{...r,...e}:null)},V=e=>{const r=e.target.closest("a");if(r&&r.href){if(r.getAttribute("href")?.startsWith("#"))return;const l=r.innerText.trim()||r.getAttribute("aria-label")||"link";L(r.href,l.substring(0,50))}};return o.jsxs("div",{className:`transition-colors duration-500 ${p?"h-full flex items-center justify-center overflow-hidden":"min-h-screen"}`,style:{backgroundColor:p?"transparent":B},onClick:V,children:[!p&&t.linkInBio?.introPage?.enabled&&m&&o.jsx(W,{config:t.linkInBio.introPage,onEnter:()=>h(!1),portfolioId:t.id}),o.jsx(i.Suspense,{fallback:o.jsx("div",{className:"h-screen flex items-center justify-center",children:o.jsx(A,{className:"animate-spin"})}),children:o.jsx("div",{className:p?"w-full h-screen":"",children:o.jsx(T,{data:k,onEdit:void 0,onUpdate:U,isEmbed:p,isFlipped:F,onToggleFlip:C})})}),!p&&!t.linkInBio?.settings?.removeBranding&&o.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:o.jsx("a",{href:"/",className:"bg-black text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg hover:scale-105 transition-transform flex items-center gap-2",children:o.jsx("span",{children:"Build your own with CareerVivid"})})})]})};export{Wr as default};
