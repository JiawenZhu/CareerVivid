import{u as k,r as i,n as h,g as a,q as P,A as U,v as A,f as d,m as J,D as w,e as f,H as R,h as l,E as j,o as q,G as z}from"./main-Bi0Ei0w3.js";const g=t=>{const p=t.title.trim().toLowerCase().replace(/[^a-z0-9\s-]/g,""),u=t.company.trim().toLowerCase().replace(/[^a-z0-9\s-]/g,"");return`${p}-${u}`.replace(/[\s/]/g,"-").slice(0,100)},L=()=>{const{currentUser:t}=k(),[p,u]=i.useState([]),[b,y]=i.useState(!0);i.useEffect(()=>{if(!t){u([]),y(!1);return}y(!0);const s=h(a,"users",t.uid,"practiceHistory"),o=P(s,U("timestamp","desc")),e=A(o,r=>{const c=r.docs.map(m=>{const n=m.data();return{id:m.id,job:n.job,questions:n.questions,interviewHistory:n.interviewHistory||[],timestamp:n.timestamp?.toMillis()||Date.now(),section:n.section||"interviews"}});u(c),y(!1)},r=>{console.error("Error fetching practice history:",r),y(!1)});return()=>e()},[t]);const H=i.useCallback(async(s,o)=>{if(!t)throw new Error("User not logged in");const e=g(s),r={...s,id:e},c=d(a,"users",t.uid,"practiceHistory",e);return(await J(c)).exists()?await w(c,{job:r,questions:o,timestamp:l()}):await f(c,{job:r,questions:o,timestamp:l(),interviewHistory:[],section:"interviews"}),e},[t]),C=i.useCallback(async(s,o)=>{if(!t)throw new Error("User not logged in");const e=d(a,"users",t.uid,"practiceHistory",s),r={...o,id:`analysis_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};return await w(e,{interviewHistory:R(r),timestamp:l()}),r},[t]),E=i.useCallback(async s=>{if(!t)throw new Error("User not logged in");const{id:o,...e}=s,r=g(e.job),c=d(a,"users",t.uid,"practiceHistory",r);return await f(c,{...e,timestamp:l(),section:"interviews"},{merge:!0}),r},[t]),v=i.useCallback(async(s,o)=>{if(t)try{const e=JSON.parse(JSON.stringify(o));delete e.id,delete e.timestamp;const r=d(a,"users",t.uid,"practiceHistory",s);await w(r,{...e,timestamp:l()})}catch(e){console.error("Error updating practice history:",e)}},[t]),D=i.useCallback(async s=>{if(!t)throw new Error("User not logged in");try{const o=d(a,"users",t.uid,"practiceHistory",s);await j(o)}catch(o){console.error("Error deleting practice history:",o)}},[t]),S=i.useCallback(async()=>{if(t)try{const s=h(a,"users",t.uid,"practiceHistory"),o=await q(s),e=z(a);o.docs.forEach(r=>{e.delete(r.ref)}),await e.commit()}catch(s){throw console.error("Error deleting all practice history:",s),s}},[t]);return{practiceHistory:p,isLoading:b,addJob:H,addAnalysisToJob:C,addCompletedPractice:E,deletePracticeHistory:D,deleteAllPracticeHistory:S,updatePracticeHistory:v}};export{L as u};
