import{q as Q,n as U,g as V,A as ee,aa as te,o as se,x as oe,h as ae,r as a,j as e,M as ne,R as re}from"./main-D7bwdUQx.js";import{C as le}from"./check-circle-2-DpEuKBG_.js";import{L as ie,G as ce}from"./index-Ct7ZtTGD.js";import{M as de}from"./music-WNGOgNMw.js";import{P as ue}from"./play-BaOA4-fe.js";import{V as me}from"./volume-x-BjYuzAy4.js";import{V as xe}from"./volume-2-CWCwFyLt.js";const be=async n=>{try{return(await oe(U(V,"portfolio_piano_recordings"),{...n,timestamp:ae()})).id}catch(d){throw console.error("Error saving piano recording:",d),d}},pe=async(n=20)=>{try{const d=Q(U(V,"portfolio_piano_recordings"),ee("timestamp","desc"),te(n));return(await se(d)).docs.map(x=>({id:x.id,...x.data()}))}catch(d){return console.error("Error fetching recordings:",d),[]}},D=[{key:"a",note:"C4",label:"C"},{key:"s",note:"D4",label:"D"},{key:"d",note:"E4",label:"E"},{key:"f",note:"F4",label:"F"},{key:"g",note:"G4",label:"G"},{key:"h",note:"A4",label:"A"},{key:"j",note:"B4",label:"B"},{key:"k",note:"C5",label:"C5"}],he=["Moonlight Sonata","Für Elise","Clair de Lune","Imagine","Bohemian Rhapsody","Let It Be","Tiny Dancer","Piano Man"],fe=({portfolioId:n,isPreview:d})=>{const[j,x]=a.useState(new Set),[M,T]=a.useState([]),[c,k]=a.useState(!1),[w,y]=a.useState(0),[I,u]=a.useState([]),[l,S]=a.useState(!1),p=a.useRef(null),h=a.useRef(null),[b,g]=a.useState(!1),[v,N]=a.useState(""),[_,i]=a.useState(!1),[K,L]=a.useState(!1),[B,q]=a.useState([]),[C,A]=a.useState(!1),E=a.useRef(null),P=()=>{E.current||(E.current=new(window.AudioContext||window.webkitAudioContext));const t=E.current;return(t.state==="suspended"||t.state==="interrupted")&&t.resume().catch(o=>console.error("Audio resume failed:",o)),t};a.useEffect(()=>{const t=()=>{const o=P();try{const s=o.createBuffer(1,1,22050),r=o.createBufferSource();r.buffer=s,r.connect(o.destination),r.start(0)}catch(s){console.error("Silent unlock failed",s)}["click","touchstart","touchend","keydown"].forEach(s=>window.removeEventListener(s,t))};return["click","touchstart","touchend","keydown"].forEach(o=>window.addEventListener(o,t)),()=>{["click","touchstart","touchend","keydown"].forEach(o=>window.removeEventListener(o,t))}},[]);const H=t=>({C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440,B4:493.88,C5:523.25})[t]||440,F=t=>{if(P(),!E.current)return;const o=E.current,s=o.createOscillator(),r=o.createGain();s.type="triangle",s.frequency.value=H(t),r.gain.setValueAtTime(.3,o.currentTime),r.gain.exponentialRampToValueAtTime(.01,o.currentTime+1.5),s.connect(r),r.connect(o.destination),s.start(),s.stop(o.currentTime+1.5)},W=()=>{h.current&&clearTimeout(h.current),c&&!l&&(h.current=setTimeout(()=>{X()},3e3))},z=t=>{if(l||b||_||C)return;const o=D.find(s=>s.key===t);if(o&&!j.has(t)&&(x(s=>new Set(s).add(t)),F(o.note),$(t),!c&&w===0&&!l&&(k(!0),p.current=Date.now()),c||!c&&w===0&&!l)){const s=p.current||Date.now(),r=Date.now()-s;u(m=>[...m,{note:o.note,time:r}]),W()}},R=t=>{x(o=>{const s=new Set(o);return s.delete(t),s})},$=t=>{const o=D.findIndex(f=>f.key===t),s=Math.random()*20+40,r=`calc(50% + ${(o-3.5)*3.5}rem - ${s/2}px)`,m=Date.now()+Math.random();T(f=>[...f,{id:m,key:t,left:r,size:s}]),setTimeout(()=>T(f=>f.filter(J=>J.id!==m)),3e3)};a.useEffect(()=>{const t=s=>z(s.key.toLowerCase()),o=s=>R(s.key.toLowerCase());return window.addEventListener("keydown",t),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",o)}},[j,c,l,b,_,C]),a.useEffect(()=>{let t;return c&&!l&&(t=setInterval(()=>y(o=>o+1),1e3)),()=>clearInterval(t)},[c,l]),a.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]);const X=()=>{k(!1),S(!0),g(!0)},Y=async()=>{if(v.trim()){if(g(!1),n)try{await be({portfolioId:n,duration:w,notes:I,visitorName:v})}catch(t){console.error(t)}setTimeout(()=>{G()},500)}},G=async()=>{i(!0),L(!0);try{const t=await pe();q(t)}catch(t){console.error(t)}finally{L(!1)}},Z=t=>{if(C)return;A(!0),t.notes.forEach(s=>{setTimeout(()=>{F(s.note);const r=D.find(m=>m.note===s.note);r&&($(r.key),x(m=>new Set(m).add(r.key)),setTimeout(()=>x(m=>{const f=new Set(m);return f.delete(r.key),f}),200))},s.time)});const o=Math.max(...t.notes.map(s=>s.time))+500;setTimeout(()=>{A(!1)},o)},O=()=>{S(!1),y(0),u([]),p.current=null,N(""),g(!1),i(!1)};return e.jsxs("div",{className:"w-full h-full relative flex flex-col items-center justify-end pb-20 overflow-hidden bg-neutral-100 select-none font-sans",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden z-0",children:M.map(t=>e.jsx("div",{className:"absolute bottom-40 border-2 border-black bg-cyan-300/40 rounded-full animate-floating-bubble shadow-[inset_-4px_-4px_10px_rgba(255,255,255,0.5),4px_4px_0px_rgba(0,0,0,1)]",style:{left:t.left,width:t.size,height:t.size}},t.id))}),e.jsxs("div",{className:"absolute top-4 left-4 md:top-8 md:left-8 flex flex-col gap-3 md:gap-4 z-20 max-w-[90vw]",children:[e.jsxs("div",{className:`
                    flex items-center gap-2 md:gap-3 px-3 py-2 md:px-5 md:py-3 border-2 border-black font-bold bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] rounded-lg transition-colors text-sm md:text-base
                    ${c?"text-red-500 border-red-500":"text-black"}
                    ${l?"text-green-600 border-green-600":""}
                 `,children:[l?e.jsx(le,{size:16,className:"md:w-5 md:h-5"}):e.jsx(ne,{className:`w-4 h-4 md:w-5 md:h-5 ${c?"animate-pulse":""}`}),e.jsx("span",{children:l?"Recorded":c?"Recording...":"Play to Record"}),e.jsx("span",{className:"font-mono bg-neutral-100 px-2 rounded border border-neutral-200",children:new Date(w*1e3).toISOString().substr(14,5)})]}),!c&&!l&&e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-3 py-2 md:px-5 md:py-3 border-2 border-black bg-yellow-300 hover:bg-yellow-400 font-bold shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] rounded-lg transition-transform active:translate-y-1 active:shadow-none text-sm md:text-base w-fit",children:[e.jsx(ie,{size:16,className:"md:w-5 md:h-5"}),e.jsx("span",{children:"Community Board"})]})]}),e.jsx("div",{className:"relative z-10 w-full flex justify-center pb-8 px-2",children:e.jsx("div",{className:`
                    flex gap-2 p-2 bg-white/80 backdrop-blur-md border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] md:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] rounded-2xl transition-all duration-500 
                    overflow-x-auto max-w-full touch-pan-x
                    ${b||_?"blur-sm scale-95 opacity-50":""}
                `,children:D.map(t=>{const o=j.has(t.key);return e.jsxs("button",{onMouseDown:()=>z(t.key),onMouseUp:()=>R(t.key),onMouseLeave:()=>R(t.key),onTouchStart:s=>{s.cancelable&&s.preventDefault(),z(t.key)},onTouchEnd:s=>{s.cancelable&&s.preventDefault(),R(t.key)},className:`
                                w-12 h-56 md:h-64 border-2 border-black rounded-b-xl flex flex-col justify-end items-center pb-6 transition-all duration-100 shrink-0 touch-none select-none
                                ${o?"bg-black text-white translate-y-2 shadow-none":"bg-white hover:bg-gray-50 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"}
                            `,children:[e.jsx("span",{className:"font-bold text-xl mb-1",children:t.label}),e.jsx("span",{className:"text-xs uppercase opacity-40 font-mono tracking-wider",children:t.key})]},t.key)})})}),e.jsx("div",{className:"absolute bottom-2 text-[10px] md:text-xs font-mono opacity-50 z-10 text-center w-full px-4",children:"Press keys A-K or tap to play • 3s silence saves"}),b&&e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[200] animate-fade-in",children:e.jsxs("div",{className:"bg-white border-4 border-black p-8 rounded-2xl shadow-[12px_12px_0px_0px_rgba(0,0,0,1)] max-w-md w-full m-4",children:[e.jsxs("h3",{className:"text-2xl font-black mb-2 flex items-center gap-2",children:[e.jsx(de,{className:"text-purple-600"}),"Melody Captured!"]}),e.jsx("p",{className:"text-gray-600 mb-6 font-medium",children:"Name your masterpiece to share it with the world."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-bold uppercase tracking-wide mb-2",children:"Track Title"}),e.jsx("input",{autoFocus:!0,type:"text",value:v,onChange:t=>N(t.target.value),placeholder:"e.g. Rainy Day Mood...",className:"w-full px-4 py-3 border-2 border-black rounded-lg text-lg font-bold focus:outline-none focus:ring-4 focus:ring-purple-200"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-xs font-bold uppercase tracking-wide mb-2 opacity-50",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:he.map(t=>e.jsx("button",{onClick:()=>N(t),className:"px-3 py-1 border border-black/20 rounded-full text-sm font-medium hover:bg-black hover:text-white transition-colors",children:t},t))})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:O,className:"flex-1 px-6 py-3 border-2 border-black font-bold rounded-lg hover:bg-gray-100 transition-colors",children:"Discard"}),e.jsx("button",{onClick:Y,disabled:!v.trim(),className:"flex-1 px-6 py-3 bg-black text-white border-2 border-black font-bold rounded-lg hover:translate-y-1 hover:shadow-none shadow-[4px_4px_0px_0px_rgba(120,120,120,1)] transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Save & Share"})]})]})}),_&&e.jsxs("div",{className:"absolute inset-0 bg-white z-[200] flex flex-col overflow-hidden animate-slide-up",children:[e.jsxs("div",{className:"p-6 border-b-4 border-black flex justify-between items-center bg-yellow-300",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black italic tracking-tighter",children:"COMMUNITY_HITS"}),e.jsx("p",{className:"font-bold opacity-60",children:"Recent jams from around the world"})]}),e.jsx("button",{onClick:O,className:"px-6 py-2 bg-black text-white font-bold rounded-full hover:scale-105 transition-transform",children:"Back to Piano"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-neutral-100",children:e.jsx("div",{className:"max-w-3xl mx-auto space-y-4",children:K?e.jsx("div",{className:"text-center py-20 opacity-50 font-bold text-xl animate-pulse",children:"Loading beats..."}):B.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"opacity-50 font-bold text-xl mb-4",children:"No beats found yet."}),e.jsx("p",{className:"opacity-40",children:"Be the first to drop a track!"})]}):B.map((t,o)=>e.jsxs("div",{className:"bg-white border-2 border-black p-4 rounded-xl shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex items-center justify-between hover:translate-x-1 hover:translate-y-[-2px] transition-transform",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-neutral-900 text-white rounded-full flex items-center justify-center font-bold font-mono",children:o+1}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg",children:t.visitorName||"Untitled Track"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm opacity-60 font-mono",children:[e.jsxs("span",{children:[t.duration,"s"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(t.timestamp?.seconds*1e3||Date.now()).toLocaleDateString()})]})]})]}),e.jsxs("button",{onClick:()=>Z(t),disabled:C,className:"px-4 py-2 border-2 border-black rounded-lg hover:bg-black hover:text-white transition-colors flex items-center gap-2 font-bold disabled:opacity-50",children:[e.jsx(ue,{size:16,fill:"currentColor"}),C?"Playing...":"Replay"]})]},t.id))})})]})]})},_e=({config:n,onEnter:d,position:j="fixed",portfolioId:x,isPreview:M=!1})=>{const[T,c]=a.useState(!0),[k,w]=a.useState(!0),[y,I]=a.useState(!1),u=re.useMemo(()=>n.assets&&n.assets.length>0?n.assets.find(i=>i.id===n.activeAssetId)||n.assets[0]:n,[n]),l=u.type||"image",S=u.contentUrl,p=u.mobileContentUrl,h=u.objectFit||"cover",b=u.mobileObjectFit||"cover",g=u.gameType,v=u.embedCode;a.useEffect(()=>{const i=()=>I(window.innerWidth<768);return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),a.useEffect(()=>{if(n.autoDismissTimer&&n.autoDismissTimer>0){const i=setTimeout(()=>{N()},n.autoDismissTimer*1e3);return()=>clearTimeout(i)}},[n.autoDismissTimer]);const N=()=>{c(!1),setTimeout(d,500)};if(!T)return null;const _=()=>{const i="px-8 py-3 rounded-full font-bold text-lg transition-all duration-300 transform hover:scale-105 active:scale-95 flex items-center gap-2 z-50";switch(n.buttonStyle){case"solid":return`${i} bg-white text-black hover:bg-gray-100 shadow-xl`;case"outline":return`${i} border-2 border-white text-white hover:bg-white/10 backdrop-blur-sm`;case"glass":return`${i} bg-white/20 border border-white/30 text-white backdrop-blur-md shadow-lg hover:bg-white/30`;default:return`${i} border-2 border-white text-white`}};return e.jsxs("div",{className:`${j} inset-0 z-[100] flex flex-col items-center justify-center bg-black transition-opacity duration-500 ${T?"opacity-100":"opacity-0 pointer-events-none"}`,children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[l==="video"&&e.jsxs(e.Fragment,{children:[e.jsx("video",{src:y&&p?p:S,className:"w-full h-full",style:{objectFit:y&&b?b:h},autoPlay:!0,loop:!0,muted:k,playsInline:!0},y?"mobile":"desktop"),e.jsx("div",{className:"absolute top-4 right-4 z-50 flex gap-2",children:e.jsx("button",{onClick:()=>w(!k),className:"p-2 bg-black/30 rounded-full text-white hover:bg-black/50 backdrop-blur-md",children:k?e.jsx(me,{size:20}):e.jsx(xe,{size:20})})})]}),l==="image"&&e.jsxs("picture",{className:"w-full h-full block",children:[p&&e.jsx("source",{media:"(max-width: 767px)",srcSet:p}),e.jsx("img",{src:S,alt:"Intro",className:"w-full h-full animate-pulse-slow",style:{objectFit:y&&b?b:h}})]}),l==="game"&&e.jsx("div",{className:"w-full h-full bg-indigo-900 flex items-center justify-center relative",children:g==="piano_flow"?e.jsx(fe,{portfolioId:x,isPreview:M}):g==="custom"&&v?e.jsx("div",{className:"w-full h-full",dangerouslySetInnerHTML:{__html:v}}):e.jsxs("div",{className:"text-center text-white p-8",children:[e.jsx(ce,{size:64,className:"mx-auto mb-4 opacity-50"}),e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Game Zone"}),e.jsxs("p",{className:"opacity-75",children:["Interactive game placeholder: ",g]})]})})]}),e.jsx("div",{className:"absolute inset-0 bg-black/20 pointer-events-none"}),e.jsx("div",{className:"relative z-50 flex flex-col items-center gap-6 animate-fade-in-up delay-300",children:e.jsx("button",{onClick:N,className:_(),children:n.buttonText||"Enter"})})]})};export{_e as I};
