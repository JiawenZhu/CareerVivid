import{r as i,x as I,n as E,g as P,h as N,R as O,j as o,L as A,f as z,m as G}from"./main-D7bwdUQx.js";import{T as y}from"./index-Ct7ZtTGD.js";import{I as W}from"./IntroOverlay-CkLFrfhu.js";import{A as q}from"./alert-circle-BRom6qOH.js";import"./InlineEdit-VvWFu2xz.js";import"./pen-BjREPpPz.js";import"./index-BLyhGMY8.js";import"./x-DMbiC8dp.js";import"./lock-DcpO_n2u.js";import"./sun-1TmOzzZR.js";import"./arrow-right-DsFsv36v.js";import"./mail-DgfX-KG1.js";import"./globe-BpfpBcoq.js";import"./download-C1tBlrUM.js";import"./play-BaOA4-fe.js";import"./map-pin-D8GAobV5.js";import"./users-C9F5B6QA.js";import"./eye-DEr-hoMY.js";import"./trending-up-DPrOYGmK.js";import"./music-WNGOgNMw.js";import"./share-2-CK0UUP72.js";import"./terminal-BonMCbCN.js";import"./chevron-right-PWzp5mFn.js";import"./zap-DWwtH8Bb.js";import"./code-B6dUF6ow.js";import"./cardTemplates-Ct8bCPLk.js";import"./stockPhotos-DkxhX0el.js";import"./smartphone-WOZ9vOzD.js";import"./layout-grid-WKuLex98.js";import"./youtube-CT18vrJ4.js";import"./twitter-BnUWIJeg.js";import"./linkedin-HQEvqZjM.js";import"./award-DYnlEXmM.js";import"./activity-CM1jkAXg.js";import"./calendar-BnGCRrKy.js";import"./graduation-cap-Ba7Sbct3.js";import"./alert-triangle-CTOevc_r.js";import"./undo-DkQhMn_e.js";import"./arrow-left-Cw-deXTS.js";import"./bar-chart-D4uRodYM.js";import"./bot-IWhsMCba.js";import"./building-2-Cq7l4Mzs.js";import"./check-circle-2-DpEuKBG_.js";import"./check-circle-Y3w2FutP.js";import"./check-CW4K69vK.js";import"./chevron-down-BPd_V80d.js";import"./chevron-left-DHCapFAF.js";import"./chevron-up-yBgMtLL6.js";import"./clock-CcciH6c9.js";import"./code-2-CMQNlPQN.js";import"./copy-Do5ViK8D.js";import"./credit-card-5AyDtlxr.js";import"./confetti.module-BGnOEfG6.js";import"./dollar-sign-DcpZw4Zw.js";import"./eye-off-C3BEQmJh.js";import"./file-code-COZLpJA5.js";import"./file-question-DZTQrbyz.js";import"./gift-Jcvedu2l.js";import"./help-circle-Z6uxOdU-.js";import"./home-B9i0WPbo.js";import"./image-Cv7iUuhM.js";import"./info-Cumc1Glk.js";import"./key-round-qsMoB6jW.js";import"./layout-dashboard-O5a-GZ1E.js";import"./layout-template-Ry3nx9r-.js";import"./link-BoT9NfQv.js";import"./log-out-i04K1esW.js";import"./mail-check-B25_6Z-D.js";import"./volume-x-BjYuzAy4.js";import"./menu-ehI2FCEu.js";import"./message-square-BENNLl4s.js";import"./square-So3YITEA.js";import"./monitor-CcJ9Smqe.js";import"./more-vertical-CpLTMDnJ.js";import"./store-D8Uycl71.js";import"./palette-0XDKs-Jr.js";import"./pen-tool-DRK-bsrA.js";import"./percent-pK9dnNdf.js";import"./plus-circle-B1zjzhT0.js";import"./refresh-cw-DTA__X86.js";import"./rocket-BsshGovh.js";import"./save-CJ-XX7QP.js";import"./search-DcLQ5dqo.js";import"./send-UNE_Yrxr.js";import"./shield-alert-DzVOFb2M.js";import"./shield-check-BFnUBgBu.js";import"./shield-CUs6q-_4.js";import"./productService-CQD1F13I.js";import"./thumbs-up-C6_U3RnA.js";import"./sparkles-BFipE19n.js";import"./star-209mo421.js";import"./stop-circle-D1RwyLxF.js";import"./target-BsDxk_ZX.js";import"./trash-2-CQCik4ER.js";import"./unlink-6ukdw9W5.js";import"./upload-cloud-CWQHg1gY.js";import"./upload-1Po4FBxs.js";import"./user-BMBnC3Yd.js";import"./video-DKmnxiHe.js";import"./volume-2-CWCwFyLt.js";import"./x-circle-BRiVfX7a.js";import"./stripeService-C8ippV--.js";import"./index-DZXmDlCI.js";import"./AlertModal-DSdN08Rw.js";import"./index-Chjiymov.js";const H=({portfolioId:n,ownerId:c,enabled:t})=>{const f=i.useRef(!1),u=()=>{let s=localStorage.getItem("cv_visitor_id");return s||(s=crypto.randomUUID(),localStorage.setItem("cv_visitor_id",s)),s};return i.useEffect(()=>{if(!t||!n||!c||f.current)return;(async()=>{try{const m=new URLSearchParams(window.location.search).get("ref")||"direct",h=u();await I(E(P,"users",c,"portfolios",n,"stats"),{type:"view",source:m,timestamp:N(),visitorId:h,userAgent:navigator.userAgent}),f.current=!0,console.log("[Analytics] View logged:",{source:m,visitorId:h})}catch(a){console.error("[Analytics] Failed to log view:",a)}})()},[n,c,t]),{trackClick:async(s,a)=>{if(!(!t||!n||!c))try{const m=u();await I(E(P,"users",c,"portfolios",n,"stats"),{type:"click",targetId:s,label:a,timestamp:N(),visitorId:m}),console.log("[Analytics] Click logged:",{targetId:s,label:a})}catch(m){console.error("[Analytics] Failed to log click:",m)}}}},Wr=()=>{const[n,c]=i.useState(null),[t,f]=i.useState(null),[u,g]=i.useState(!0),[s,a]=i.useState(""),[m,h]=i.useState(!0);i.useEffect(()=>{const r=window.location.pathname.split("/").filter(l=>l!=="");if(r.length>0){const l=r[r.length-1];l!=="portfolio"?c(l):(a("Invalid portfolio link."),g(!1))}else a("Invalid portfolio link."),g(!1)},[]),i.useEffect(()=>{if(!n)return;(async()=>{try{const r=z(P,"public_portfolios",n),l=await G(r);if(l.exists()){const j=l.data();f(j);const M=window.location.pathname;if(j.username&&M.match(/\/portfolio\/[^/]+$/)){const $=`/portfolio/${j.username}/${n}`;window.history.replaceState(null,"",$)}}else a("Portfolio not found or is private.")}catch(r){console.error("Error fetching portfolio:",r),a("Failed to load portfolio.")}finally{g(!1)}})()},[n]);const{trackClick:L}=H({portfolioId:t?.id,ownerId:t?.userId,enabled:!!t}),x=new URLSearchParams(window.location.search),p=x.get("embed")==="true",v=x.get("theme"),b=x.get("orientation"),d=x.get("flipped"),_=d!==null?d==="true":void 0,[F,C]=i.useState(_);i.useEffect(()=>{d!==null&&C(d==="true")},[d]);const k=O.useMemo(()=>{if(!t)return null;let e={...t};return v&&(e.templateId=v),b&&(e.businessCard={...e.businessCard||{},orientation:b}),e},[t,v,b]);if(u)return o.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:o.jsx(A,{className:"w-10 h-10 text-indigo-600 animate-spin"})});if(s||!t)return o.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 text-center p-4",children:[o.jsx(q,{className:"w-16 h-16 text-gray-400 mb-4"}),o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Portfolio Not Found"}),o.jsx("p",{className:"text-gray-600",children:s})]});const T=(()=>{if(k?.mode==="linkinbio"){const e=k.templateId;return["linktree_minimal","linktree_visual","linktree_corporate","linktree_bento"].includes(e)?y[e]:y.linktree_visual}return y[k?.templateId]||y.minimalist})(),D={darkMode:!1},w=t.theme||D,S=w.darkMode,R=w.backgroundColor?.toLowerCase()==="#ffffff"||w.backgroundColor?.toLowerCase()==="#fff",B=S&&R?"#0f1117":w.backgroundColor||(S?"#0f1117":"#ffffff"),U=e=>{t&&f(r=>r?{...r,...e}:null)},V=e=>{const r=e.target.closest("a");if(r&&r.href){if(r.getAttribute("href")?.startsWith("#"))return;const l=r.innerText.trim()||r.getAttribute("aria-label")||"link";L(r.href,l.substring(0,50))}};return o.jsxs("div",{className:`transition-colors duration-500 ${p?"h-full flex items-center justify-center overflow-hidden":"min-h-screen"}`,style:{backgroundColor:p?"transparent":B},onClick:V,children:[!p&&t.linkInBio?.introPage?.enabled&&m&&o.jsx(W,{config:t.linkInBio.introPage,onEnter:()=>h(!1),portfolioId:t.id}),o.jsx(i.Suspense,{fallback:o.jsx("div",{className:"h-screen flex items-center justify-center",children:o.jsx(A,{className:"animate-spin"})}),children:o.jsx("div",{className:p?"w-full h-screen":"",children:o.jsx(T,{data:k,onEdit:void 0,onUpdate:U,isEmbed:p,isFlipped:F,onToggleFlip:C})})}),!p&&!t.linkInBio?.settings?.removeBranding&&o.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:o.jsx("a",{href:"/",className:"bg-black text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg hover:scale-105 transition-transform flex items-center gap-2",children:o.jsx("span",{children:"Build your own with CareerVivid"})})})]})};export{Wr as default};
