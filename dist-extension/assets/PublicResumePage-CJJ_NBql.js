const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Editor-DJLUd0Qt.js","assets/main-D7bwdUQx.js","assets/main-z6OAJ5_I.css","assets/CommentsPanel-DPyg5v6n.js","assets/check-circle-Y3w2FutP.js","assets/x-DMbiC8dp.js","assets/message-square-BENNLl4s.js","assets/user-BMBnC3Yd.js","assets/send-UNE_Yrxr.js","assets/AlertModal-DSdN08Rw.js","assets/index-BLyhGMY8.js","assets/ConfirmationModal-JrZwKFGF.js","assets/alert-triangle-CTOevc_r.js","assets/FeedbackModal-CbS_Se9-.js","assets/star-209mo421.js","assets/sparkles-BFipE19n.js","assets/check-CW4K69vK.js","assets/ShareResumeModal-E3tlevaV.js","assets/share-2-CK0UUP72.js","assets/globe-BpfpBcoq.js","assets/lock-DcpO_n2u.js","assets/copy-Do5ViK8D.js","assets/trash-2-CQCik4ER.js","assets/building-2-Cq7l4Mzs.js","assets/calendar-BnGCRrKy.js","assets/chevron-left-DHCapFAF.js","assets/ResumePreview-Jk-mDOMr.js","assets/types-C3IBSKjb.js","assets/InlineEdit-VvWFu2xz.js","assets/pen-BjREPpPz.js","assets/link-BoT9NfQv.js","assets/mail-DgfX-KG1.js","assets/video-DKmnxiHe.js","assets/youtube-CT18vrJ4.js","assets/twitter-BnUWIJeg.js","assets/linkedin-HQEvqZjM.js","assets/map-pin-D8GAobV5.js","assets/code-B6dUF6ow.js","assets/graduation-cap-Ba7Sbct3.js","assets/zap-DWwtH8Bb.js","assets/bar-chart-D4uRodYM.js","assets/undo-DkQhMn_e.js","assets/square-So3YITEA.js","assets/ThemeToggle-DsA95TmZ.js","assets/sun-1TmOzzZR.js","assets/useTranslation-DTfaX8qA.js","assets/arrow-left-Cw-deXTS.js","assets/more-vertical-CpLTMDnJ.js","assets/eye-DEr-hoMY.js","assets/image-Cv7iUuhM.js","assets/download-C1tBlrUM.js","assets/chevron-down-BPd_V80d.js","assets/geminiService-y_3auqFB.js","assets/storageService-BNxWpd1U.js","assets/AIImprovementPanel-BB8CVWdZ.js","assets/AIImageEditModal-m4lJEj2r.js","assets/upload-1Po4FBxs.js","assets/MonthYearPicker-CXRrYW0t.js","assets/chevron-right-PWzp5mFn.js","assets/ResumeImport-NX6dZbBI.js","assets/index-Dz481ECF.js","assets/index-Chjiymov.js","assets/pdf.worker.min-Dea1Jy7I.js","assets/alert-circle-BRom6qOH.js","assets/upload-cloud-CWQHg1gY.js","assets/useAICreditCheck-C1GxJsBq.js","assets/chevron-up-yBgMtLL6.js","assets/plus-circle-B1zjzhT0.js","assets/palette-0XDKs-Jr.js","assets/arrow-right-DsFsv36v.js","assets/save-CJ-XX7QP.js","assets/index-CheEFsob.js","assets/proxy-BQaq4QdM.js","assets/info-Cumc1Glk.js","assets/x-circle-BRiVfX7a.js"])))=>i.map(i=>d[i]);
import{r as t,u as Y,j as e,L as z,p as k,R as Z,_ as ee}from"./main-D7bwdUQx.js";import{P as N}from"./PublicHeader-BiLchFHM.js";import{F as te}from"./Footer-CxHvxPO8.js";import{L as se}from"./Logo-DPBmgvCf.js";import{T as re}from"./ThemeToggle-DsA95TmZ.js";import{s as ae,a as ne,C as oe,T as ie,p as $}from"./CommentsPanel-DPyg5v6n.js";import{A as le}from"./alert-circle-BRom6qOH.js";import{L as M}from"./layout-dashboard-O5a-GZ1E.js";import{U as _}from"./user-BMBnC3Yd.js";import{L as ce}from"./log-out-i04K1esW.js";import"./LanguageSelect-Ja_59MY8.js";import"./useTranslation-DTfaX8qA.js";import"./globe-BpfpBcoq.js";import"./chevron-down-BPd_V80d.js";import"./check-CW4K69vK.js";import"./sun-1TmOzzZR.js";import"./x-DMbiC8dp.js";import"./menu-ehI2FCEu.js";import"./zap-DWwtH8Bb.js";import"./link-BoT9NfQv.js";import"./check-circle-Y3w2FutP.js";import"./message-square-BENNLl4s.js";import"./send-UNE_Yrxr.js";const de=Z.lazy(()=>ee(()=>import("./Editor-DJLUd0Qt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74]))),Ve=()=>{const[l,I]=t.useState(null),[F,u]=t.useState(!0),[S,m]=t.useState(""),[ue,B]=t.useState(.2),[me,fe]=t.useState(!1),[p,D]=t.useState(!1),[V,xe]=t.useState(!1),[R,W]=t.useState(null),[he,H]=t.useState([]),[pe,K]=t.useState(!1),[ge,g]=t.useState(!1),[P,y]=t.useState(null),[E,q]=t.useState([]),b=t.useRef(!0),w=t.useRef(null);t.useRef(null);const f=t.useRef(null),[o,G]=t.useState(null),{currentUser:a,isPremium:ye,isAdmin:be,logOut:J}=Y(),[L,C]=t.useState(!1),j=t.useRef(null);t.useEffect(()=>{const r=s=>{j.current&&!j.current.contains(s.target)&&C(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]);const v=()=>e.jsx("header",{className:"bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800 shadow-sm sticky top-0 z-40 h-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("a",{href:"/dashboard",className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-8 w-8"}),e.jsx("span",{className:"text-xl font-bold text-gray-900 dark:text-white hidden sm:inline",children:"CareerVivid"})]})}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsxs("button",{onClick:()=>k("/dashboard"),className:"hidden md:flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors mr-2",children:[e.jsx(M,{size:18}),"Back to Dashboard"]}),e.jsx(re,{}),e.jsxs("div",{className:"relative",ref:j,children:[e.jsx("button",{onClick:()=>C(!L),className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 ring-2 ring-transparent hover:ring-primary-500 transition-all",children:a?.photoURL?e.jsx("img",{src:a.photoURL,alt:"User",className:"w-full h-full rounded-full object-cover"}):e.jsx(_,{size:20})}),L&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-xl z-50 border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:a?.displayName||"User"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:a?.email})]}),e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>k("/dashboard"),className:"w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx(M,{size:16})," Dashboard"]}),e.jsxs("button",{onClick:()=>k("/profile"),className:"w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx(_,{size:16})," Profile"]}),e.jsxs("button",{onClick:J,className:"w-full text-left flex items-center gap-2 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/10",children:[e.jsx(ce,{size:16})," Sign Out"]})]})]})]})]})]})});t.useEffect(()=>{const r=async(s=0)=>{const c=window.location.pathname.split("?")[0].split("/").filter(x=>x!==""),h=c.indexOf("shared");if(h===-1||c.length<h+3){m("Invalid link format."),u(!1);return}const U=c[h+1],O=c[h+2];G({userId:U,resumeId:O});try{const X=`https://us-west1-jastalk-firebase.cloudfunctions.net/getPublicResume?userId=${encodeURIComponent(U)}&resumeId=${encodeURIComponent(O)}`,d=await fetch(X);if(d.ok){const A=await d.json();I(A),K(A.ownerIsPremium||!1),u(!1)}else d.status===403?(m("This resume is private or no longer shared."),u(!1)):d.status===404?(m("Resume not found."),u(!1)):d.status===500&&s<1?(console.warn("Got 500 error, retrying..."),setTimeout(()=>r(s+1),1500)):(console.error(`Fetch error: ${d.status} ${d.statusText}`),m(`Failed to load resume (Status: ${d.status}). The server might be waking up.`),u(!1))}catch(x){console.error("Error fetching resume:",x),x.message==="Failed to fetch"||x.name==="TypeError"?m("Connection failed. This is likely a CORS issue or the function doesn't have public permissions."):m("Unable to load resume. Please try again later."),u(!1)}};r()},[]),t.useEffect(()=>{if(!l||!o)return;a&&a.uid===o.userId||l.shareConfig?.permission;const r=ae(o.userId,o.resumeId,n=>{if(!b.current&&n.length>E.length){const i=n[0];a&&a.uid===o.userId&&i.userId!==a.uid&&(y(`New feedback received from ${i.author}`),$())}q(n)}),s=ne(o.userId,o.resumeId,n=>{if(n){const i=!!R;W(n.imageUrl),n.objects&&H(n.objects),a&&a.uid===o.userId&&!b.current&&!i&&(y(`New annotation received from ${n.author||"Reviewer"}`),$())}});return setTimeout(()=>{b.current=!1},1e3),()=>{r(),s()}},[l,o,E.length,R,p,V,a]),t.useLayoutEffect(()=>{const r=()=>{if(w.current){const s=w.current.offsetWidth;s>0&&B(Math.min(1,(s-40)/824))}};return l&&(r(),window.addEventListener("resize",r)),()=>window.removeEventListener("resize",r)},[l]),t.useEffect(()=>{const r=s=>{if(s.key==="Escape"||s.code==="Escape"){g(!1),f.current&&(f.current.style.display="none");return}s.metaKey&&s.shiftKey&&(f.current&&(f.current.style.display="flex"),g(!0)),(s.key==="PrintScreen"||s.code==="PrintScreen")&&(f.current&&(f.current.style.display="flex"),g(!0))};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]);const Q=async r=>{if(!o||!l)return;const s={...l,...r};I(s);try{const i=await fetch("https://us-west1-jastalk-firebase.cloudfunctions.net/updatePublicResume",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o.userId,resumeId:o.resumeId,data:r})});if(!i.ok){const c=await i.text();throw console.error("Update failed response:",c),new Error(`Update failed: ${i.status}`)}}catch(n){console.error("Failed to save shared update:",n),alert("Failed to save changes. Please check your connection.")}};if(F)return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex flex-col",children:[a?e.jsx(v,{}):e.jsx(N,{}),e.jsxs("div",{className:"flex-grow flex items-center justify-center flex-col gap-3",children:[e.jsx(z,{className:"w-12 h-12 text-primary-500 animate-spin"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading secure content..."})]})]});if(S||!l||!o)return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex flex-col",children:[a?e.jsx(v,{}):e.jsx(N,{}),e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center p-4 text-center",children:[e.jsx(le,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Unable to View Resume"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md",children:S})]})]});const T=l.shareConfig?.permission||"viewer";if(T==="editor"){const r=window.location.search.substring(1),s=new URLSearchParams(r),n=s.get("viewMode")||"edit",i=s.get("activeTab")||"content";return e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx(z,{className:"animate-spin"})}),children:e.jsx(de,{initialData:l,isShared:!0,onSharedUpdate:Q,initialViewMode:n,initialActiveTab:i})})}return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-950 flex flex-col font-sans relative",children:[a?e.jsx(v,{}):e.jsx(N,{}),e.jsx("div",{className:`bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 pb-4 px-4 shadow-sm sticky z-30 ${a?"top-20 pt-4":"top-0 pt-24"}`}),e.jsx("main",{className:"flex-grow p-4 sm:p-8 relative",ref:w,children:e.jsx("div",{className:`max-w-5xl mx-auto flex justify-center transition-all duration-300 ${p?"mr-[320px]":""}`})}),T==="commenter"&&e.jsx(oe,{isOpen:p,onClose:()=>D(!1),resumeId:o.resumeId,ownerId:o.userId,currentUser:a}),e.jsx(te,{}),P&&e.jsx(ie,{message:P,onClose:()=>y(null)})]})};export{Ve as default};
