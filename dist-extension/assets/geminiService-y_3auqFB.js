import{b as w,h as T,x as R,n as N,g as S,t as u}from"./main-D7bwdUQx.js";const m=async(s,e)=>{try{const t=w.currentUser,r={userId:t?.uid||null,userEmail:t?.email||null,message:s.message,stack:s.stack,url:window.location.href,timestamp:T(),status:"New",context:{...e,userAgent:navigator.userAgent}};await R(N(S,"error_reports"),r),console.log("Error reported successfully.")}catch(t){console.error("Failed to report error:",t),console.error("Original error that failed to be reported:",s)}},b="https://us-west1-jastalk-firebase.cloudfunctions.net/geminiProxy",y=3;class I{constructor(){this.queue=[],this.activeRequests=0}async add(e){return new Promise((t,r)=>{const n=async()=>{this.activeRequests++;try{const o=await e();t(o)}catch(o){r(o)}finally{this.activeRequests--,this.processNext()}};this.activeRequests<y?n():this.queue.push(n)})}processNext(){if(this.queue.length>0&&this.activeRequests<y){const e=this.queue.shift();e&&e()}}}const v=new I,f=async(s,e=3,t=1e3)=>{try{return await s()}catch(r){if(e>0&&(r.message?.includes("429")||r.message?.includes("503")))return await new Promise(n=>setTimeout(n,t)),f(s,e-1,t*2);throw r}},l=async s=>v.add(()=>f(async()=>{try{let e=s.contents;typeof e=="string"?e=[{role:"user",parts:[{text:e}]}]:e&&typeof e=="object"&&!Array.isArray(e)&&e.parts&&(e=[e]);const t=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{...s,contents:e}})});if(!t.ok){const a=await t.text();throw t.status===429?new Error(`Gemini Rate Limit (429): ${a}`):t.status===503?new Error(`Gemini Service Overloaded (503): ${a}`):new Error(`Proxy Error (${t.status}): ${a}`)}if(!t.body)throw new Error("No response body received from proxy.");const r=t.body.getReader(),n=new TextDecoder;let o="";const c="__END_GEMINI__";for(;;){const{done:a,value:d}=await r.read();if(a)break;o+=n.decode(d,{stream:!0})}o+=n.decode();const p=o.split(c);if(p.length<2){try{const a=JSON.parse(o);if(a.error)throw new Error(a.error)}catch{}return console.warn("Gemini Proxy response missing end marker. Returning buffer as text.",o),{text:o,response:{}}}const i=p[1];try{return JSON.parse(i)}catch{throw console.error("Failed to parse proxy payload JSON",i),new Error("Failed to parse AI response.")}}catch(e){throw console.error("CallGeminiProxy failed:",e),e}})),g={type:"OBJECT",properties:{personalDetails:{type:"OBJECT",description:"The user's personal contact information.",properties:{jobTitle:{type:"STRING",description:"The user's desired job title. Return an empty string if not found."},firstName:{type:"STRING",description:"The user's first name. Return an empty string if not found."},lastName:{type:"STRING",description:"The user's last name. Return an empty string if not found."},email:{type:"STRING",description:"The user's email address. Return an empty string if not found."},phone:{type:"STRING",description:"The user's phone number. Return an empty string if not found."},address:{type:"STRING",description:"The user's full street address (e.g., '123 Cloud Lane'). Return an empty string if not found."},city:{type:"STRING",description:"The user's city. Return an empty string if not found."},postalCode:{type:"STRING",description:"The user's postal or zip code. Return an empty string if not found."},country:{type:"STRING",description:"The user's country. Return an empty string if not found."}},required:["jobTitle","firstName","lastName","email","phone","address","city","postalCode","country"]},professionalSummary:{type:"STRING",description:"A 3-5 sentence professional summary. Return an empty string if not found."},websites:{type:"ARRAY",description:"A list of websites or social links. Return an empty array if none are found.",items:{type:"OBJECT",properties:{label:{type:"STRING",description:"The name of the website (e.g., LinkedIn, GitHub)."},url:{type:"STRING",description:"The full URL."}},required:["label","url"]}},skills:{type:"ARRAY",description:"A list of skills. Return an empty array if none are found.",items:{type:"OBJECT",properties:{name:{type:"STRING",description:"The name of the skill."},level:{type:"STRING",description:"The user's proficiency level (e.g., Expert, Advanced, Intermediate). If not specified, infer a reasonable level like 'Advanced'."}},required:["name","level"]}},languages:{type:"ARRAY",description:"A list of languages spoken by the user. Return an empty array if none are found.",items:{type:"OBJECT",properties:{name:{type:"STRING",description:"The name of the language (e.g., English, Spanish)."},level:{type:"STRING",description:"The user's proficiency level (e.g., Native, Fluent). If not specified, infer a reasonable level like 'Proficient'."}},required:["name","level"]}},employmentHistory:{type:"ARRAY",description:"A list of past employment positions. Return an empty array if none are found.",items:{type:"OBJECT",properties:{jobTitle:{type:"STRING"},employer:{type:"STRING"},city:{type:"STRING",description:"The city where the job was located. Return an empty string if not found."},startDate:{type:"STRING",description:"e.g., 'Jan 2020' or '2020'"},endDate:{type:"STRING",description:"e.g., 'Present' or 'Dec 2022'"},description:{type:"STRING",description:"A few bullet points (use markdown for lists) or a short paragraph describing responsibilities and achievements."}},required:["jobTitle","employer","city","startDate","endDate","description"]}},education:{type:"ARRAY",description:"A list of educational qualifications. Return an empty array if none are found.",items:{type:"OBJECT",properties:{school:{type:"STRING"},degree:{type:"STRING"},city:{type:"STRING",description:"The city where the school was located. Return an empty string if not found."},startDate:{type:"STRING"},endDate:{type:"STRING"},description:{type:"STRING",description:"Optional details about the degree or coursework. Return an empty string if not found."}},required:["school","degree","city","startDate","endDate","description"]}}},required:["personalDetails","professionalSummary","websites","skills","languages","employmentHistory","education"]},G=async(s,e,t)=>{try{const r=`The following resume is in ${t}. Parse it and extract all available information into a structured JSON format that strictly conforms to the provided schema. If a section (like 'languages') is not present in the text, return an empty array for it. If a simple field (like 'phone') is not present, return an empty string for it. Here is the resume text:

---

${e}`,n={responseMimeType:"application/json",responseSchema:g},o=await l({modelName:"gemini-3-flash",contents:r,config:n}).catch(()=>l({modelName:"gemini-2.5-flash",contents:r,config:n})),c=o.response?.usageMetadata?.totalTokenCount||0;await u(s,"resume_parse_text",{tokenUsage:c});const p=o.text.trim(),i=JSON.parse(p),a=d=>{d&&d.forEach(h=>h.id=crypto.randomUUID())};return a(i.websites),a(i.skills),a(i.languages),a(i.employmentHistory),a(i.education),i}catch(r){throw console.error("Error parsing resume with AI:",r),m(r,{functionName:"parseResume"}),new Error("Failed to parse resume with AI. Please check the format or try again.")}},j=async(s,e,t,r,n,o="resume")=>{try{const c={type:"OBJECT",properties:{improvedContent:{type:"STRING",description:"The rewritten and improved text content."},explanation:{type:"STRING",description:"A brief, 1-2 sentence explanation of why this change is better or why it's important. Keep it professional and helpful."}},required:["improvedContent","explanation"]};let p;o==="blog post"?p=`Role: You are an expert career coach...
Task: Rewrite and improve the following "${e}" section.
Instructions:
1. Tone: Professional, authoritative, and actionable.
2. Structure: Use Markdown.
3. User Instruction: "${r}"
4. Language: ${n}

Current Content:
---
${t}
---

Return a JSON object with 'improvedContent' and 'explanation'.`:p=`Rewrite the following "${e}" section for a ${o} in ${n}. Follow the user's instruction: "${r}".
            
Current Text:
---
${t}
---
            
Return a JSON object with:
1. improvedContent: The improved text.
2. explanation: A brief explanation (1-2 sentences) of why this improvement is beneficial.`;const i=await l({modelName:"gemini-2.5-flash",contents:p,config:{responseMimeType:"application/json",responseSchema:c}}),a=i.response?.usageMetadata?.totalTokenCount||0;return await u(s,"resume_suggestion",{tokenUsage:a}),JSON.parse(i.text.trim())}catch(c){throw console.error("Error improving section:",c),m(c,{functionName:"improveSection"}),new Error("Failed to improve section with AI.")}},C=async(s,e,t,r)=>{try{const o=await l({modelName:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:t,data:e}},{text:r}]},config:{responseModalities:["IMAGE"]}}),c=o.response?.usageMetadata?.totalTokenCount||1e3;await u(s,"image_generation",{tokenUsage:c});const p=o.response?.candidates;if(p&&p[0]?.content?.parts){for(const i of p[0].content.parts)if(i.inlineData){const a=i.inlineData.data;return`data:${i.inlineData.mimeType||"image/png"};base64,${a}`}}throw new Error("AI did not return an image.")}catch(n){throw console.error("Error editing photo:",n),m(n,{functionName:"editProfilePhoto"}),new Error("Failed to edit photo with AI.")}},J=async(s,e)=>{try{const t=`Generate a complete, professional resume based on the following description: "${e}". The resume should be tailored for this role and must include a professional summary, a list of 8-10 relevant technical and soft skills, 2-3 detailed example employment history entries with 3-4 achievement-oriented bullet points each, and a relevant education entry. Use realistic but placeholder personal details (e.g., John Doe, anytown, etc.). Respond with a structured JSON object that strictly conforms to the provided schema. Ensure all required fields are populated.`,n={responseMimeType:"application/json",responseSchema:{...g,required:["personalDetails","professionalSummary","skills","employmentHistory","education"]}},o=await l({modelName:"gemini-3-flash",contents:t,config:n}).catch(()=>l({modelName:"gemini-2.5-flash",contents:t,config:n})),c=o.response?.usageMetadata?.totalTokenCount||0;s.startsWith("guest_")||await u(s,"resume_generate_prompt",{tokenUsage:c});const p=o.text.trim(),i=JSON.parse(p),a=d=>{d&&d.forEach(h=>h.id=crypto.randomUUID())};return a(i.websites),a(i.skills),a(i.languages),a(i.employmentHistory),a(i.education),i}catch(t){throw console.error("Error generating resume from prompt:",t),m(t,{functionName:"generateResumeFromPrompt"}),new Error("Failed to generate resume with AI. Please try a different prompt.")}},O=async(s,e,t,r)=>{const n='You are an expert AI assistant for the "CareerVivid" application...';try{const o=await l({modelName:"gemini-2.5-flash",contents:[...e,{role:"user",parts:[{text:t}]}],systemInstruction:n}),c=o.response?.usageMetadata?.totalTokenCount||0;return await u(s,"ai_assistant_query",{tokenUsage:c}),o.text}catch(o){return console.error("Error in general chat:",o),m(o,{functionName:"generalChat"}),"Sorry, I encountered an error. Please try again."}},M=async(s,e)=>{try{const r=await l({modelName:"gemini-2.5-flash",contents:"Based on the following description, generate a list of 5-7 insightful interview questions...",config:{responseMimeType:"application/json",responseSchema:{type:"ARRAY",items:{type:"STRING"}}}}),n=r.response?.usageMetadata?.totalTokenCount||0;return await u(s,"question_generation",{tokenUsage:n}),JSON.parse(r.text.trim())}catch(t){throw console.error("Error generating interview questions:",t),m(t,{functionName:"generateInterviewQuestions"}),new Error("Failed to generate interview questions with AI.")}},q=async s=>{try{const e=`Based on the following description, generate a list of 2-3 insightful interview questions for a short demo interview. The questions should be relevant to the role described. Return ONLY a valid JSON array of strings, with no other text or explanation. Description: "${s}"`,t=await l({modelName:"gemini-2.5-flash",contents:e,config:{responseMimeType:"application/json",responseSchema:{type:"ARRAY",items:{type:"STRING"}}}});return JSON.parse(t.text.trim())}catch(e){throw console.error("Error generating demo interview questions:",e),m(e,{functionName:"generateDemoInterviewQuestions"}),new Error("Failed to generate interview questions with AI. Please try a different prompt.")}},P=async(s,e,t,r)=>{try{const n=e.map(d=>`${d.speaker==="ai"?"Interviewer":"Candidate"}: ${d.text}`).join(`

`),o=`You are an expert interview coach. Your task is to analyze the following interview transcript and provide a structured, objective, and constructive feedback report in JSON format. The interview was for the role described as: '${t}'.
...
**Transcript:**
---
${n}
---
...
Your entire response MUST be a valid JSON object that conforms to the provided schema.`,c={responseMimeType:"application/json",responseSchema:{type:"OBJECT",properties:{overallScore:{type:"NUMBER",description:"A weighted average score from 0 to 100."},communicationScore:{type:"NUMBER",description:"A score from 0 to 100 for communication skills."},confidenceScore:{type:"NUMBER",description:"A score from 0 to 100 for confidence."},relevanceScore:{type:"NUMBER",description:"A score from 0 to 100 for answer relevance."},strengths:{type:"STRING",description:"A markdown-formatted string summarizing the candidate's strengths."},areasForImprovement:{type:"STRING",description:"A markdown-formatted string with actionable tips for improvement."}},required:["overallScore","communicationScore","confidenceScore","relevanceScore","strengths","areasForImprovement"]}},p=await l({modelName:"gemini-3-flash",contents:o,config:c}).catch(()=>l({modelName:"gemini-2.5-flash",contents:o,config:c})),a={tokenUsage:p.response?.usageMetadata?.totalTokenCount||0};return r&&r>0&&(a.durationInSeconds=r),await u(s,"interview_analysis",a),JSON.parse(p.text.trim())}catch(n){throw console.error("Error analyzing transcript:",n),m(n,{functionName:"analyzeInterviewTranscript"}),new Error("Failed to analyze interview transcript.")}},A={type:"OBJECT",properties:{totalKeywords:{type:"NUMBER",description:"The total number of unique, important keywords extracted from the job description."},matchedKeywords:{type:"ARRAY",description:"A list of keywords found in both the job description and the resume.",items:{type:"STRING"}},missingKeywords:{type:"ARRAY",description:"A list of important keywords from the job description that were NOT found in the resume.",items:{type:"STRING"}},matchPercentage:{type:"NUMBER",description:"A percentage score (0-100) representing the ratio of matched keywords to total keywords."},summary:{type:"STRING",description:"A brief, 2-3 sentence summary of the resume's strengths and weaknesses against the job description."}},required:["totalKeywords","matchedKeywords","missingKeywords","matchPercentage","summary"]},_=async(s,e,t)=>{try{const r=`Act as an expert recruiter scanning a resume for a job opening.
Job Description:
${t}
Resume:
${e}
Return match stats in described JSON schema.`,n=await l({modelName:"gemini-2.5-flash",contents:r,config:{responseMimeType:"application/json",responseSchema:A}}),o=n.response?.usageMetadata?.totalTokenCount||0;return await u(s,"resume_match_analysis",{tokenUsage:o}),JSON.parse(n.text.trim())}catch(r){throw console.error("Error analyzing resume match:",r),m(r,{functionName:"analyzeResumeMatch"}),new Error("Failed to analyze the resume match with AI.")}},E={type:"OBJECT",properties:{jobTitle:{type:"STRING",description:"The job title. Return 'Untitled Job' if not found."},companyName:{type:"STRING",description:"The company name. Return 'Unknown Company' if not found."},location:{type:"STRING",description:"The job location (e.g., city, state, or 'Remote'). Return an empty string if not found."}},required:["jobTitle","companyName","location"]},U=async(s,e)=>{try{const t=`Analyze the following job description text... ${e}`,r=await l({modelName:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:E}}),n=r.response?.usageMetadata?.totalTokenCount||0;return await u(s,"job_parse_description",{tokenUsage:n}),JSON.parse(r.text.trim())}catch(t){throw console.error("Error parsing job description from text:",t),m(t,{functionName:"parseJobDescriptionFromText"}),new Error("Failed to analyze the job description with AI.")}},k={type:"OBJECT",properties:{prep_RoleOverview:{type:"STRING",description:"Detailed research..."},prep_MyStory:{type:"STRING",description:"A compelling 2-3 paragraph..."},prep_InterviewPrep:{type:"STRING",description:"A numbered list of 5-7 potential interview questions..."},prep_QuestionsForInterviewer:{type:"STRING",description:"A numbered list of 3-5 insightful questions..."},notes:{type:"STRING",description:"A bulleted list of general notes..."}},required:["prep_RoleOverview","prep_MyStory","prep_InterviewPrep","prep_QuestionsForInterviewer","notes"]},D=async(s,e,t)=>{try{const r=`You are an expert career coach... [Job: ${e.jobTitle}]`,n=await l({modelName:"gemini-2.5-flash",contents:r,config:{responseMimeType:"application/json",responseSchema:k}}),o=n.response?.usageMetadata?.totalTokenCount||0;return await u(s,"job_prep_generation",{tokenUsage:o}),JSON.parse(n.text.trim())}catch(r){throw console.error("Error generating job prep notes:",r),m(r,{functionName:"generateJobPrepNotes"}),new Error("Failed to generate AI preparation notes.")}},$=async(s,e,t,r,n)=>{try{const o=`...Regenerate content for "${e}"...`,c=await l({modelName:"gemini-2.5-flash",contents:o}),p=c.response?.usageMetadata?.totalTokenCount||0;return await u(s,"job_prep_regeneration",{tokenUsage:p}),c.text.trim()}catch(o){throw console.error("Error regenerating job prep section:",o),m(o,{functionName:"regenerateJobPrepSection"}),new Error("Failed to regenerate section with AI.")}};export{O as a,_ as b,P as c,M as d,C as e,U as f,J as g,q as h,j as i,D as j,G as p,$ as r};
